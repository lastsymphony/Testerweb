<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
  <title>Komik Reader</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root{
      --primary:#4361ee; --secondary:#3f37c9; --accent:#f72585;
      --dark:#1f2533; --light:#f5f7fb; --text:#1c2430;
    }
    *{box-sizing:border-box} html,body{margin:0}
    body{font-family:system-ui,-apple-system,Inter,Segoe UI,Roboto,Arial,sans-serif;background:#0b1020;color:#e8eefc}

    /* Header */
    header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,#0f1740,#0b1020);border-bottom:1px solid rgba(255,255,255,.08)}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}
    .header-content{display:flex;align-items:center;justify-content:space-between;min-height:56px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700}
    .logo i{color:var(--accent)}
    nav ul{display:flex;list-style:none;gap:16px;margin:0;padding:0}
    nav a{color:#eaf1ff;text-decoration:none;font-weight:600;opacity:.9}
    nav a:hover{opacity:1}
    .burger{display:none;background:transparent;border:0;color:#fff;font-size:1.4rem;padding:.25rem .5rem;border-radius:.5rem}

    @media (max-width:768px){
      .burger{display:block}
      nav .nav-menu{display:none;position:absolute;left:0;right:0;top:56px;background:#0f1740;border-bottom:1px solid rgba(255,255,255,.08);padding:10px 16px}
      nav .nav-menu.open{display:block}
      nav .nav-menu li{margin:8px 0}
    }

    /* Search */
    .search-wrap{background:#0b1020;border-bottom:1px solid rgba(255,255,255,.08)}
    .search-form{display:flex;gap:8px;max-width:720px;margin:0 auto;padding:12px 0}
    .search-input{flex:1;border:1px solid rgba(255,255,255,.14);background:#0a122c;color:#eaf1ff;border-radius:999px;padding:10px 14px;outline:none}
    .search-btn{border:0;background:var(--accent);color:#fff;border-radius:999px;padding:10px 14px;font-weight:700;cursor:pointer}

    /* Sections */
    main.container{padding:18px 16px}
    .section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .section-title{font-size:1.25rem;margin:0}
    .row-controls{display:flex;align-items:center;gap:10px}
    .btn{border:0;background:#1e2a5f;color:#eaf1ff;border-radius:999px;padding:8px 14px;cursor:pointer}
    #autoSpeed{width:180px}

    /* Netflix Row */
    .row-scroll{display:flex;gap:14px;overflow-x:auto;padding:8px 2px 16px;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch}
    .row-scroll::-webkit-scrollbar{height:8px}
    .row-scroll::-webkit-scrollbar-thumb{background:#2a3a7a;border-radius:8px}
    .comic-card{flex:0 0 160px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:12px;overflow:hidden;scroll-snap-align:start;cursor:pointer;transition:transform .15s ease}
    .comic-card:hover{transform:translateY(-3px)}
    .comic-cover{width:100%;height:220px;object-fit:contain;background:#0a122c}
    .comic-info{padding:10px}
    .comic-title{font-size:.95rem;line-height:1.2;margin:0 0 6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .comic-meta{display:flex;justify-content:space-between;font-size:.8rem;color:#a9b7ff;opacity:.9}
    .comic-type{background:#1e2a5f;padding:2px 8px;border-radius:999px}

    /* Detail */
    .comic-detail{display:none;background:#0a122c;border:1px solid rgba(255,255,255,.08);border-radius:14px;overflow:hidden}
    .comic-detail.active{display:block}
    .comic-detail-header{display:flex;flex-wrap:wrap;gap:18px;padding:18px;border-bottom:1px solid rgba(255,255,255,.06);background:linear-gradient(90deg,rgba(67,97,238,.1),rgba(247,37,133,.08))}
    .comic-detail-cover{width:220px;height:300px;object-fit:contain;background:#0b1020;border-radius:10px}
    .comic-detail-title{margin:0 0 8px}
    .meta-list{display:grid;grid-template-columns:auto 1fr;gap:6px 14px;font-size:.95rem;color:#cfe0ff}
    .chapter-list{padding:16px}
    .chapter-items{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px}
    .chapter-item{background:#0f1740;border:1px solid rgba(255,255,255,.08);padding:10px 12px;border-radius:10px;display:flex;justify-content:space-between;cursor:pointer}
    .chapter-item:hover{background:#142060}

    /* Reader */
    .comic-reader{display:none;background:#0a122c;border:1px solid rgba(255,255,255,.08);border-radius:14px;overflow:hidden;margin-top:18px}
    .comic-reader.active{display:block}
    .reader-header{padding:10px 16px;background:#0f1740;border-bottom:1px solid rgba(255,255,255,.06);display:flex;justify-content:space-between;align-items:center}
    .reader-title{margin:0;font-size:1rem}
    .reader-controls{display:flex;gap:8px}
    .reader-control-btn{border:0;background:transparent;color:#eaf1ff;font-size:1.2rem;cursor:pointer;padding:6px;border-radius:8px}
    .reader-control-btn:hover{background:rgba(255,255,255,.08)}
    .reader-content{padding:14px;text-align:center}
    .reader-image{max-width:100%;margin:6px auto;box-shadow:0 6px 16px rgba(0,0,0,.2)}

    /* Toast */
    .toast{position:fixed;bottom:16px;right:16px;background:#0f1740;border:1px solid rgba(255,255,255,.14);color:#eaf1ff;padding:10px 14px;border-radius:10px;opacity:0;transform:translateY(20px);transition:.2s;z-index:100}
    .toast.show{opacity:1;transform:translateY(0)}

    /* Loading */
    .loading{display:flex;align-items:center;justify-content:center;height:120px}
    .spinner{width:40px;height:40px;border:4px solid rgba(255,255,255,.15);border-radius:50%;border-top-color:#6ea8fe;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo"><i class="fas fa-book-open"></i> <span>Komik Reader</span></div>
        <button class="burger" id="burgerBtn" aria-label="Menu"><i class="fas fa-bars"></i></button>
        <nav>
          <ul class="nav-menu">
            <li><a href="#" class="nav-link active" data-section="home">Beranda</a></li>
            <li><a href="#" class="nav-link" data-section="terbaru">Terbaru</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <!-- Search -->
  <div class="search-wrap">
    <div class="container">
      <form class="search-form" id="searchForm">
        <input id="searchInput" class="search-input" placeholder="Cari komik yang kamu suka..." />
        <button class="search-btn" type="submit"><i class="fas fa-search"></i> Cari</button>
      </form>
    </div>
  </div>

  <!-- Main -->
  <main class="container">
    <!-- Home (Terbaru Netflix Row) -->
    <section id="homeSection" class="content-section">
      <div class="section-header">
        <h2 class="section-title">Komik Terbaru</h2>
        <div class="row-controls">
          <button class="btn" id="autoPlayBtn">▶ Putar</button>
          <label for="autoSpeed">Kecepatan</label>
          <input type="range" id="autoSpeed" min="1" max="10" value="4">
        </div>
      </div>
      <div class="row-scroll" id="latestComics">
        <div class="loading"><div class="spinner"></div></div>
      </div>
    </section>

    <!-- Terbaru Section (grid penuh jika dibutuhkan) -->
    <section id="terbaruSection" class="content-section" style="display:none;">
      <div class="section-header"><h2 class="section-title">Komik Terbaru</h2></div>
      <div class="row-scroll" id="allLatestComics"><div class="loading"><div class="spinner"></div></div></div>
      <div class="pagination" id="latestPagination"></div>
    </section>

    <!-- Detail -->
    <section id="comicDetailSection" class="comic-detail">
      <div class="comic-detail-header">
        <img id="comicDetailCover" class="comic-detail-cover" alt="Cover">
        <div class="comic-detail-info">
          <h1 id="comicDetailTitle" class="comic-detail-title"></h1>
          <div class="meta-list">
            <div>Tipe</div><div id="comicDetailType">-</div>
            <div>Genre</div><div id="comicDetailGenre">-</div>
          </div>
          <p id="comicDetailDescription" style="margin-top:10px"></p>
        </div>
      </div>
      <div class="chapter-list">
        <h3 style="margin:0 0 10px">Daftar Chapter</h3>
        <div id="chapterList" class="chapter-items"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </section>

    <!-- Reader -->
    <section id="comicReaderSection" class="comic-reader">
      <div class="reader-header">
        <h3 id="readerTitle" class="reader-title">Reader</h3>
        <div class="reader-controls">
          <button class="reader-control-btn" id="zoomInBtn"><i class="fas fa-search-plus"></i></button>
          <button class="reader-control-btn" id="zoomOutBtn"><i class="fas fa-search-minus"></i></button>
          <button class="reader-control-btn" id="fullscreenBtn"><i class="fas fa-expand"></i></button>
          <button class="reader-control-btn" id="closeReaderBtn"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div id="readerContent" class="reader-content"><div class="loading"><div class="spinner"></div></div></div>
      <div style="display:flex;gap:8px;justify-content:space-between;padding:10px 16px;border-top:1px solid rgba(255,255,255,.06)">
        <button class="btn" id="prevChapterBtn">◀ Chapter Sebelumnya</button>
        <button class="btn" id="nextChapterBtn">Chapter Selanjutnya ▶</button>
      </div>
    </section>
  </main>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
  /********** CONFIG **********/
  const BASE = 'https://www.sankavollerei.com';
  const API_BASE_URL = 'https://www.sankavollerei.com/comic';
  // ROOT untuk trailing slash routing di GitHub Pages
  const ROOT_PATH = (location.pathname.endsWith('/') ? location.pathname : location.pathname + '/').replace(/(?:index\.html)?$/,'');

  /********** UTIL **********/
  function isApkEntry(comic){
    const t=(comic?.title||'').toLowerCase();
    const link=(comic?.link||comic?.href||'').toLowerCase();
    return t.includes('apk') || link.includes('/apk');
  }
  function imgOriginal(url, seed){
    if(!url) return `https://picsum.photos/seed/${encodeURIComponent(seed)}/180/250.jpg`;
    const noQuery = url.split('?')[0];
    const noProto = noQuery.replace(/^https?:\/\//,'');
    return `https://images.weserv.nl/?url=${encodeURIComponent(noProto)}`;
  }
  // map /manga/... atau /detail-komik/... -> /comic/comic/{slug}
  function toDetailUrl(linkOrHref=''){
    const clean = (s)=> (s||'').replace(/^https?:\/\/[^/]+/,'').replace(/^\/+|\/+$/g,'');
    let p = clean(linkOrHref);
    if(p.startsWith('manga/'))         return `${BASE}/comic/comic/${p.replace(/^manga\/|\/$/g,'')}`;
    if(p.startsWith('detail-komik/'))  return `${BASE}/comic/comic/${p.replace(/^detail-komik\/|\/$/g,'')}`;
    if(p.startsWith('comic/comic/'))    return `${BASE}/${p}`;
    return `${BASE}/comic/comic/${p.replace(/\/$/,'')}`;
  }
  async function fetchJSON(url,{timeoutMs=12000}={}){
    const ctl = new AbortController(); const to=setTimeout(()=>ctl.abort(),timeoutMs);
    try{ const res=await fetch(url,{signal:ctl.signal,headers:{accept:'application/json'},mode:'cors',cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status); return await res.json();
    } finally{ clearTimeout(to); }
  }
  function showToast(msg='Terjadi kesalahan'){ const el=document.getElementById('toast'); el.textContent=msg; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'),2500); }

  /********** BUILDERS **********/
  window.createComicCard = function (comic){
    if(isApkEntry(comic)) return document.createTextNode('');
    const link = comic.link || '';
    const cover = imgOriginal(comic.image, link);
    const card = document.createElement('div');
    card.className='comic-card';
    card.dataset.link=link;
    card.dataset.cover=cover;
    card.innerHTML = `
      <img class="comic-cover" src="${cover}" alt="${comic.title||''}" loading="lazy"
           onerror="this.onerror=null;this.src='https://picsum.photos/seed/${encodeURIComponent(link)}/180/250.jpg'">
      <div class="comic-info">
        <h3 class="comic-title">${comic.title||''}</h3>
        <div class="comic-meta"><span class="comic-type">${comic.type||'Manga'}</span><span>${comic.chapter||''}</span></div>
      </div>`;
    return card;
  };
  window.createSearchComicCard = function (comic){
    if(isApkEntry(comic)) return document.createTextNode('');
    const href = comic.href || '';
    const cover = imgOriginal(comic.thumbnail, href);
    const card = document.createElement('div');
    card.className='comic-card';
    card.dataset.link=href;
    card.dataset.cover=cover;
    card.innerHTML = `
      <img class="comic-cover" src="${cover}" alt="${comic.title||''}" loading="lazy"
           onerror="this.onerror=null;this.src='https://picsum.photos/seed/${encodeURIComponent(href)}/180/250.jpg'">
      <div class="comic-info">
        <h3 class="comic-title">${comic.title||''}</h3>
        <div class="comic-meta"><span class="comic-type">${comic.type||'Manga'}</span><span>${comic.genre||''}</span></div>
      </div>`;
    return card;
  };
  function appendFiltered(container, list, isSearch=false){
    const maker = isSearch ? window.createSearchComicCard : window.createComicCard;
    const filtered = (list||[]).filter(c=>!isApkEntry(c));
    container.innerHTML = '';
    if(!filtered.length){ container.innerHTML='<p style="opacity:.8">Tidak ada komik.</p>'; return; }
    filtered.forEach(c => { const n=maker(c); if(n && n.nodeType!==3) container.appendChild(n); });
  }

  /********** STATE **********/
  const sections=[...document.querySelectorAll('.content-section')];
  const homeSection=document.getElementById('homeSection');
  const terbaruSection=document.getElementById('terbaruSection');
  const comicDetailSection=document.getElementById('comicDetailSection');
  const comicReaderSection=document.getElementById('comicReaderSection');
  let currentComic=null, currentChapters=[], currentChapter=null, readerZoom=1;

  /********** NAV **********/
  function navigateToSection(section){
    sections.forEach(s=>s.style.display='none');
    comicDetailSection.classList.remove('active');
    comicReaderSection.classList.remove('active');
    if(section==='terbaru'){ terbaruSection.style.display='block'; loadLatestComics(1); }
    else { homeSection.style.display='block'; loadHomeContent(); }
    setRoute(section,{view:'section',section});
    window.scrollTo(0,0);
  }
  document.querySelectorAll('.nav-link').forEach(a=>{
    a.addEventListener('click',e=>{ e.preventDefault(); navigateToSection(a.dataset.section); document.querySelectorAll('.nav-link').forEach(x=>x.classList.remove('active')); a.classList.add('active'); const menu=document.querySelector('nav .nav-menu'); menu?.classList.remove('open'); });
  });
  // Burger
  document.getElementById('burgerBtn').addEventListener('click',()=>{ document.querySelector('nav .nav-menu').classList.toggle('open'); });

  /********** ROUTER (trailing slash) **********/
  function setRoute(path,state={}){
    let p = (path||'').replace(/\/+$/,'')+'/';
    const url = ROOT_PATH.replace(/\/+$/,'/') + p.replace(/^\/+/,'');
    history.pushState(state,'',url);
  }
  window.addEventListener('popstate',(e)=>{
    const st=e.state||{};
    if(st.view==='detail' && st.slug){ loadComicDetail(st.originalLink||(`/manga/${st.slug}/`),{coverFromCard:st.cover||''}); return; }
    if(st.view==='section'){ navigateToSection(st.section); return; }
    navigateToSection('home');
  });

  /********** HOME (Netflix Row) **********/
  function loadHomeContent(){ loadLatestComicsPreview(); }
  window.loadLatestComicsPreview = function(){
    const container=document.getElementById('latestComics');
    container.innerHTML='<div class="loading"><div class="spinner"></div></div>';
    fetchJSON(`${API_BASE_URL}/terbaru`)
      .then(data=>{
        // data.comics -> daftar komik terbaru
        appendFiltered(container, data.comics);
        attachCardOpenDetail(container);
      })
      .catch(()=>container.innerHTML='<p>Terjadi kesalahan saat memuat komik terbaru</p>');
  };

  /********** LIST TERBARU (halaman khusus) **********/
  window.loadLatestComics = function(page=1){
    const container=document.getElementById('allLatestComics');
    container.innerHTML='<div class="loading"><div class="spinner"></div></div>';
    fetchJSON(`${API_BASE_URL}/terbaru?page=${page}`)
      .then(data=>{
        appendFiltered(container, data.comics);
        attachCardOpenDetail(container);
      })
      .catch(()=>container.innerHTML='<p>Terjadi kesalahan saat memuat komik terbaru</p>');
  };

  /********** SEARCH **********/
  const searchForm=document.getElementById('searchForm');
  const searchInput=document.getElementById('searchInput');
  searchForm.addEventListener('submit',(e)=>{
    e.preventDefault();
    const q=searchInput.value.trim(); if(!q) return;
    // tampilkan home (baris) dengan hasil search sementara di ganti kontennya
    sections.forEach(s=>s.style.display='none');
    homeSection.style.display='block';
    const container=document.getElementById('latestComics');
    container.innerHTML='<div class="loading"><div class="spinner"></div></div>';
    fetchJSON(`${API_BASE_URL}/search?q=${encodeURIComponent(q)}`)
      .then(data=>{
        // data.data -> hasil search
        appendFiltered(container, data.data, true);
        attachCardOpenDetail(container);
      })
      .catch(()=>container.innerHTML='<p>Terjadi kesalahan saat mencari komik</p>');
  });

  /********** DETAIL **********/
  function attachCardOpenDetail(container){
    container?.querySelectorAll('.comic-card').forEach(card=>{
      const link = card.dataset.link||'';
      const cover = card.dataset.cover||'';
      const slug = (link.replace(/^\/+|\/+$/g,'').split('/').pop()) || 'komik';
      card.addEventListener('click',()=>{
        setRoute(`komik/${encodeURIComponent(slug)}`,{view:'detail',slug,originalLink:link,cover});
        loadComicDetail(link,{coverFromCard:cover});
      });
    });
  }
  async function loadComicDetail(linkOrHref,{retry=1,coverFromCard=''}={}){
    const detailUrl = toDetailUrl(linkOrHref);
    const coverEl = document.getElementById('comicDetailCover');
    const titleEl = document.getElementById('comicDetailTitle');
    const descEl = document.getElementById('comicDetailDescription');
    const typeEl = document.getElementById('comicDetailType');
    const genreEl = document.getElementById('comicDetailGenre');
    const chapterListEl = document.getElementById('chapterList');

    sections.forEach(s=>s.style.display='none');
    comicReaderSection.classList.remove('active');
    comicDetailSection.classList.add('active');
    window.scrollTo(0,0);

    // set cover langsung dari kartu
    if(coverEl && coverFromCard) coverEl.src = coverFromCard;
    chapterListEl.innerHTML='<div class="loading"><div class="spinner"></div></div>';

    try{
      const data = await fetchJSON(detailUrl); // {title, synopsis, chapters:[]}
      currentComic = data;
      currentChapters = Array.isArray(data.chapters) ? data.chapters : [];

      titleEl.textContent = data.title || 'Tanpa judul';
      typeEl.textContent = data.type || 'Manga';
      genreEl.textContent = data.genre || '-';
      descEl.innerHTML = (data.synopsis||'').replace(/\n/g,'<br>');

      if(!currentChapters.length){ chapterListEl.innerHTML='<p style="opacity:.8">Belum ada chapter.</p>'; }
      else{
        chapterListEl.innerHTML = currentChapters.map((c,idx)=>{
          const name = c.chapter || `Chapter ${currentChapters.length-idx}`;
          const link = c.link || '';
          return `<div class="chapter-item" data-ch="${encodeURIComponent(link)}"><span>${name}</span><span>→</span></div>`;
        }).join('');
        chapterListEl.querySelectorAll('.chapter-item').forEach(it=>{
          it.addEventListener('click',()=>{
            const ch = decodeURIComponent(it.getAttribute('data-ch')||'');
            currentChapter = ch;
            loadChapter(ch);
          });
        });
      }
    }catch(e){
      if(retry>0) return loadComicDetail(linkOrHref,{retry:retry-1,coverFromCard});
      console.error(e); showToast('Terjadi kesalahan saat memuat detail komik');
    }
  }

  /********** READER / CHAPTER **********/
  async function loadChapter(chapterLink){
    const readerContent=document.getElementById('readerContent');
    const titleEl=document.getElementById('readerTitle');
    readerZoom=1;
    readerContent.innerHTML='<div class="loading"><div class="spinner"></div></div>';
    comicReaderSection.classList.add('active');
    window.scrollTo(0,0);

    try{
      const absolute = chapterLink.startsWith('http') ? chapterLink : `${BASE}${chapterLink.startsWith('/')?'':'/'}${chapterLink}`;
      const data = await fetchJSON(`${API_BASE_URL}/chapter?url=${encodeURIComponent(absolute)}`);
      // data.images = array URL gambar halaman
      if(Array.isArray(data.images) && data.images.length){
        titleEl.textContent = `${currentComic?.title || 'Chapter'} • ${chapterLink.split('/').pop()}`;
        readerContent.innerHTML='';
        data.images.forEach(src=>{
          const img=document.createElement('img');
          img.src=src; img.className='reader-image'; img.style.transform=`scale(${readerZoom})`;
          readerContent.appendChild(img);
        });
        // prev/next
        const idx = currentChapters.findIndex(c=>c.link===chapterLink);
        document.getElementById('prevChapterBtn').disabled = idx<=0;
        document.getElementById('nextChapterBtn').disabled = idx<0 || idx>=currentChapters.length-1;
      }else{
        readerContent.innerHTML='<p>Gagal memuat chapter</p>';
      }
    }catch(e){
      console.error(e);
      readerContent.innerHTML='<p>Terjadi kesalahan saat memuat chapter</p>';
    }
  }
  document.getElementById('prevChapterBtn').addEventListener('click',()=>{
    if(!currentChapters.length || !currentChapter) return;
    const idx=currentChapters.findIndex(c=>c.link===currentChapter);
    if(idx>0){ currentChapter=currentChapters[idx-1].link; loadChapter(currentChapter); }
  });
  document.getElementById('nextChapterBtn').addEventListener('click',()=>{
    if(!currentChapters.length || !currentChapter) return;
    const idx=currentChapters.findIndex(c=>c.link===currentChapter);
    if(idx>=0 && idx<currentChapters.length-1){ currentChapter=currentChapters[idx+1].link; loadChapter(currentChapter); }
  });

  // Reader controls
  document.getElementById('zoomInBtn').addEventListener('click',()=>{ readerZoom=Math.min(2.5, readerZoom+0.1); document.querySelectorAll('.reader-image').forEach(i=>i.style.transform=`scale(${readerZoom})`); });
  document.getElementById('zoomOutBtn').addEventListener('click',()=>{ readerZoom=Math.max(0.5, readerZoom-0.1); document.querySelectorAll('.reader-image').forEach(i=>i.style.transform=`scale(${readerZoom})`); });
  document.getElementById('fullscreenBtn').addEventListener('click',()=>{ if(!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{}); else document.exitFullscreen(); });
  document.getElementById('closeReaderBtn').addEventListener('click',()=>{ comicReaderSection.classList.remove('active'); });

  /********** AUTO SCROLL (Netflix Row) **********/
  let autoTimer=null, autoPlaying=false;
  function rowVisible(){
    const row=document.getElementById('latestComics'); if(!row) return false;
    const r=row.getBoundingClientRect(); return r.bottom>0 && r.top<innerHeight;
  }
  function startAutoScroll(){
    stopAutoScroll();
    const row=document.getElementById('latestComics'); if(!row) return;
    const speed=Number(document.getElementById('autoSpeed')?.value||4);
    const step=4+speed*4;
    autoPlaying=true; document.getElementById('autoPlayBtn').textContent='⏸ Jeda';
    autoTimer=setInterval(()=>{ if(!rowVisible()) return; row.scrollLeft += step; if(row.scrollLeft+row.clientWidth>=row.scrollWidth-2) row.scrollLeft=0; },40);
  }
  function stopAutoScroll(){ autoPlaying=false; if(autoTimer) clearInterval(autoTimer); autoTimer=null; document.getElementById('autoPlayBtn').textContent='▶ Putar'; }
  document.getElementById('autoPlayBtn').addEventListener('click',()=>{ autoPlaying?stopAutoScroll():startAutoScroll(); });
  document.getElementById('autoSpeed').addEventListener('input',()=>{ if(autoPlaying) startAutoScroll(); });
  document.addEventListener('visibilitychange',()=>{ if(document.hidden) stopAutoScroll(); });
  const rowEl=document.getElementById('latestComics');
  ;['pointerdown','wheel','touchstart','mouseenter'].forEach(ev=>{ rowEl.addEventListener(ev,()=>{ if(autoPlaying) stopAutoScroll(); },{passive:true}); });

  /********** INIT **********/
  document.addEventListener('DOMContentLoaded',()=>{
    // Hilangkan footer (sesuai request)
    document.querySelectorAll('footer').forEach(f=>f.remove());
    loadHomeContent();
  });
  </script>
</body>
</html>
