<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Komik Reader - Baca Komik Online</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #f72585;
            --dark-color: #2b2d42;
            --light-color: #f8f9fa;
            --text-color: #333;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo i {
            margin-right: 10px;
            color: var(--accent-color);
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: 4px;
        }

        nav ul li a:hover, nav ul li a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Burger Menu */
        .burger {
            display: none;
            background: transparent;
            border: 0;
            color: #fff;
            font-size: 1.5rem;
            padding: .25rem .5rem;
            border-radius: .5rem;
        }

        /* Search Bar */
        .search-container {
            background-color: white;
            padding: 1.5rem 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .search-form {
            display: flex;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            border: 1px solid #ddd;
            border-radius: 30px 0 0 30px;
            font-size: 1rem;
            outline: none;
        }

        .search-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 0 30px 30px 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-btn:hover {
            background-color: #e61776;
        }

        .advanced-search-toggle {
            position: absolute;
            right: 120px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Advanced Search */
        .advanced-search {
            display: none;
            background-color: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            margin-top: 1rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .advanced-search.active {
            display: block;
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
        }

        .filter-item label {
            margin-bottom: 5px;
            font-weight: 500;
        }

        .filter-item select, .filter-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.8rem;
            color: var(--dark-color);
            position: relative;
            padding-bottom: 10px;
        }

        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background-color: var(--accent-color);
        }

        .view-all-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
        }

        .view-all-btn:hover {
            background-color: var(--secondary-color);
        }

        /* Comic Grid */
        .comic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 3rem;
        }

        .comic-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .comic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        /* Cover full (tanpa crop), tetap rapi */
        .comic-cover{ 
            width:100%; 
            height:220px; 
            object-fit:contain; 
            background:#eef1f7; 
        }

        .comic-info {
            padding: 15px;
        }

        .comic-title {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .comic-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #666;
        }

        .comic-type {
            background-color: var(--accent-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        /* Comic Detail */
        .comic-detail {
            display: none;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .comic-detail.active {
            display: block;
        }

        .comic-detail-header {
            display: flex;
            flex-wrap: wrap;
            padding: 2rem;
            background: linear-gradient(to right, rgba(67, 97, 238, 0.1), rgba(247, 37, 133, 0.1));
        }

        /* cover di halaman detail */
        .comic-detail-cover{
            width: 220px;
            height: 300px;
            object-fit: contain;     /* <— biar full, tidak terpotong */
            background: #eef1f7;
        }

        .comic-detail-info {
            flex: 1;
            min-width: 250px;
        }

        .comic-detail-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .comic-detail-meta {
            margin-bottom: 1.5rem;
        }

        .meta-item {
            margin-bottom: 8px;
            display: flex;
        }

        .meta-label {
            font-weight: 600;
            width: 100px;
        }

        .comic-detail-description {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .comic-detail-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: #e9ecef;
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background-color: #dee2e6;
        }

        /* Chapter List */
        .chapter-list {
            padding: 2rem;
        }

        .chapter-list-header {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .chapter-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }

        .chapter-item {
            padding: 12px 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chapter-item:hover {
            background-color: #e9ecef;
        }

        .chapter-number {
            font-weight: 600;
        }

        .chapter-date {
            font-size: 0.85rem;
            color: #666;
        }

        /* Comic Reader */
        .comic-reader {
            display: none;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .comic-reader.active {
            display: block;
        }

        .reader-header {
            padding: 1rem 2rem;
            background-color: var(--dark-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reader-title {
            font-size: 1.2rem;
        }

        .reader-controls {
            display: flex;
            gap: 10px;
        }

        .reader-control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .reader-control-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .reader-content {
            padding: 2rem;
            text-align: center;
        }

        .reader-image {
            max-width: 100%;
            margin-bottom: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .reader-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            gap: 5px;
        }

        .page-btn {
            padding: 8px 12px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
        }

        .page-btn:hover {
            background-color: #f8f9fa;
        }

        .page-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--dark-color);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Genre Filter */
        .genre-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .genre-btn {
            padding: 8px 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .genre-btn:hover {
            background-color: #f8f9fa;
        }

        .genre-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Type Filter */
        .type-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .type-btn {
            padding: 8px 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .type-btn:hover {
            background-color: #f8f9fa;
        }

        .type-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .comic-detail-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .comic-detail-cover {
                margin-right: 0;
                margin-bottom: 1rem;
            }

            .comic-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }

            .filter-group {
                grid-template-columns: 1fr;
            }
        }

        /* tombol "Pencarian Lanjutan" jangan numpuk input saat layar kecil */
        @media (max-width: 640px) {
            .search-form { 
                flex-wrap: wrap; 
                gap: 8px; 
            }
            .search-input { 
                border-radius: 30px; 
            }
            .advanced-search-toggle {
                position: static; 
                order: 3; 
                transform: none; 
                width: 100%;
                text-align: left; 
                padding: 6px 10px; 
                color: #3f37c9;
            }
            .search-btn { 
                order: 2; 
                border-radius: 30px; 
            }
        }

        /* sembunyikan kolom pertama footer */
        .footer-content .footer-section:first-child { 
            display: none; 
        }

        /* sembunyikan tab trending jika diperlukan */
        .nav-link[data-section="trending"],
        #trendingSection,
        #trendingComics { 
            display: none !important; 
        }

        /* Burger Menu Responsive */
        @media (max-width: 768px) {
            .burger { display: block; }
            nav .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0; right: 0;
                background: var(--primary-color);
                padding: 10px 20px;
                box-shadow: 0 10px 20px rgba(0,0,0,.1);
            }
            nav .nav-menu.open { display: block; }
            nav .nav-menu li { margin: 10px 0; }
        }

        /* Hide footer completely */
        footer { 
            display: none !important; 
        }

        /* Hide Populer/Trending (home + sections + nav) */
        #popularComics, #trendingComics,
        #populerSection, #trendingSection,
        .nav-link[data-section="populer"],
        .nav-link[data-section="trending"],
        .section-header:has(+ #popularComics),
        .section-header:has(+ #trendingComics) { 
            display:none !important; 
        }

        /* Netflix-like row */
        .row-scroll {
            display:flex; 
            gap:16px; 
            overflow-x:auto; 
            padding:6px 2px 14px;
            scroll-snap-type:x mandatory; 
            -webkit-overflow-scrolling:touch;
        }
        .row-scroll::-webkit-scrollbar{height:8px}
        .row-scroll::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:8px}

        /* Cards in row: fixed width so it slides like Netflix */
        .row-scroll .comic-card{ 
            flex:0 0 160px; 
            scroll-snap-align:start 
        }

        /* Controls */
        .row-controls{ 
            display:flex; 
            align-items:center; 
            gap:10px; 
            margin:8px 0 18px 
        }
        .row-controls .btn{ 
            padding:8px 14px; 
            border-radius:999px 
        }
        #autoSpeed{ 
            width:200px 
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-book-open"></i>
                    <span>Komik Reader</span>
                </div>
                <button class="burger" id="burgerBtn" aria-label="Menu">
                    <i class="fas fa-bars"></i>
                </button>
                <nav>
                    <ul class="nav-menu">
                        <li><a href="#" class="nav-link active" data-section="home">Beranda</a></li>
                        <li><a href="#" class="nav-link" data-section="terbaru">Terbaru</a></li>
                        <li><a href="#" class="nav-link" data-section="populer">Populer</a></li>
                        <li><a href="#" class="nav-link" data-section="trending">Trending</a></li>
                        <li><a href="#" class="nav-link" data-section="browse">Browse</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Search Section -->
    <div class="search-container">
        <div class="container">
            <form class="search-form" id="searchForm">
                <input type="text" class="search-input" id="searchInput" placeholder="Cari komik yang kamu suka...">
                <button type="button" class="advanced-search-toggle" id="advancedSearchToggle">Pencarian Lanjutan</button>
                <button type="submit" class="search-btn">
                    <i class="fas fa-search"></i> Cari
                </button>
            </form>
            
            <div class="advanced-search" id="advancedSearch">
                <div class="filter-group">
                    <div class="filter-item">
                        <label for="filterType">Tipe</label>
                        <select id="filterType">
                            <option value="all">Semua</option>
                            <option value="manga">Manga</option>
                            <option value="manhwa">Manhwa</option>
                            <option value="manhua">Manhua</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="filterGenre">Genre</label>
                        <select id="filterGenre">
                            <option value="all">Semua</option>
                            <option value="action">Action</option>
                            <option value="adventure">Adventure</option>
                            <option value="comedy">Comedy</option>
                            <option value="drama">Drama</option>
                            <option value="fantasy">Fantasy</option>
                            <option value="horror">Horror</option>
                            <option value="romance">Romance</option>
                            <option value="slice-of-life">Slice of Life</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="filterOrder">Urutkan</label>
                        <select id="filterOrder">
                            <option value="latest">Terbaru</option>
                            <option value="popular">Terpopuler</option>
                            <option value="rating">Rating Tertinggi</option>
                        </select>
                    </div>
                </div>
                <button type="button" class="btn btn-primary" id="applyAdvancedSearch">Terapkan Filter</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container">
        <!-- Home Section -->
        <section id="homeSection" class="content-section">
            <!-- Komik Terbaru (Netflix style) -->
            <div class="section-header">
                <h2 class="section-title">Komik Terbaru</h2>
                <div class="row-controls">
                    <button class="btn btn-secondary" id="autoPlayBtn">▶ Putar</button>
                    <label for="autoSpeed">Kecepatan</label>
                    <input type="range" id="autoSpeed" min="1" max="10" value="4">
                </div>
            </div>
            <div class="row-scroll" id="latestComics">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- Popular Comics -->
            <div class="section-header">
                <h2 class="section-title">Komik Populer</h2>
                <a href="#" class="view-all-btn" data-section="populer">Lihat Semua</a>
            </div>
            <div class="comic-grid" id="popularComics">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- Trending Comics -->
            <div class="section-header">
                <h2 class="section-title">Komik Trending</h2>
                <a href="#" class="view-all-btn" data-section="trending">Lihat Semua</a>
            </div>
            <div class="comic-grid" id="trendingComics">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </section>

        <!-- Latest Comics Section -->
        <section id="terbaruSection" class="content-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Komik Terbaru</h2>
            </div>
            <div class="comic-grid" id="allLatestComics">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="pagination" id="latestPagination"></div>
        </section>

        <!-- Popular Comics Section -->
        <section id="populerSection" class="content-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Komik Populer</h2>
            </div>
            <div class="comic-grid" id="allPopularComics">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="pagination" id="popularPagination"></div>
        </section>

        <!-- Trending Comics Section -->
        <section id="trendingSection" class="content-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Komik Trending</h2>
            </div>
            <div class="comic-grid" id="allTrendingComics">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </section>

        <!-- Browse Section -->
        <section id="browseSection" class="content-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Browse Komik</h2>
            </div>
            
            <!-- Type Filter -->
            <div class="type-filter">
                <button class="type-btn active" data-type="all">Semua</button>
                <button class="type-btn" data-type="manga">Manga</button>
                <button class="type-btn" data-type="manhwa">Manhwa</button>
                <button class="type-btn" data-type="manhua">Manhua</button>
            </div>
            
            <!-- Genre Filter -->
            <div class="genre-filter" id="genreFilter">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <div class="comic-grid" id="browseComics">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="pagination" id="browsePagination"></div>
        </section>

        <!-- Genre Section -->
        <section id="genreSection" class="content-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title" id="genreTitle">Komik Genre</h2>
            </div>
            <div class="comic-grid" id="genreComics">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="pagination" id="genrePagination"></div>
        </section>

        <!-- Search Results Section -->
        <section id="searchResultsSection" class="content-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Hasil Pencarian</h2>
            </div>
            <div class="comic-grid" id="searchResults">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="pagination" id="searchPagination"></div>
        </section>

        <!-- Comic Detail Section -->
        <section id="comicDetailSection" class="comic-detail">
            <div class="comic-detail-header">
                <img src="" alt="Comic Cover" class="comic-detail-cover" id="comicDetailCover">
                <div class="comic-detail-info">
                    <h1 class="comic-detail-title" id="comicDetailTitle"></h1>
                    <div class="comic-detail-meta">
                        <div class="meta-item">
                            <span class="meta-label">Tipe:</span>
                            <span id="comicDetailType"></span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Genre:</span>
                            <span id="comicDetailGenre"></span>
                        </div>
                    </div>
                    <p class="comic-detail-description" id="comicDetailDescription"></p>
                    <div class="comic-detail-actions">
                        <button class="btn btn-primary" id="bookmarkBtn">
                            <i class="fas fa-bookmark"></i> Tandai
                        </button>
                        <button class="btn btn-secondary" id="shareBtn">
                            <i class="fas fa-share-alt"></i> Bagikan
                        </button>
                    </div>
                </div>
            </div>
            <div class="chapter-list">
                <h3 class="chapter-list-header">Daftar Chapter</h3>
                <div class="chapter-items" id="chapterList">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Comic Reader Section -->
        <section id="comicReaderSection" class="comic-reader">
            <div class="reader-header">
                <h3 class="reader-title" id="readerTitle"></h3>
                <div class="reader-controls">
                    <button class="reader-control-btn" id="zoomInBtn">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button class="reader-control-btn" id="zoomOutBtn">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button class="reader-control-btn" id="fullscreenBtn">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="reader-control-btn" id="closeReaderBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="reader-content" id="readerContent">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="reader-navigation">
                <button class="btn btn-secondary" id="prevChapterBtn">
                    <i class="fas fa-chevron-left"></i> Chapter Sebelumnya
                </button>
                <button class="btn btn-secondary" id="nextChapterBtn">
                    Chapter Selanjutnya <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </section>
    </main>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // ====== KONFIG ======
        const BASE = 'https://www.sankavollerei.com';
        const API_BASE_URL = BASE + '/comic';
        
        // ROOT path untuk GitHub Pages (selalu akhiri dengan /)
        const ROOT_PATH = (location.pathname.endsWith('/') ? location.pathname : location.pathname + '/')
          .replace(/(?:index\.html)?$/, '');
        
        // DOM Elements
        const sections = document.querySelectorAll('.content-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const viewAllBtns = document.querySelectorAll('.view-all-btn');
        const searchForm = document.getElementById('searchForm');
        const searchInput = document.getElementById('searchInput');
        const advancedSearchToggle = document.getElementById('advancedSearchToggle');
        const advancedSearch = document.getElementById('advancedSearch');
        const applyAdvancedSearch = document.getElementById('applyAdvancedSearch');
        const comicDetailSection = document.getElementById('comicDetailSection');
        const comicReaderSection = document.getElementById('comicReaderSection');
        const toast = document.getElementById('toast');
        
        // State Management
        let currentSection = 'home';
        let currentPage = {
            terbaru: 1,
            populer: 1,
            browse: 1,
            search: 1,
            genre: 1
        };
        let currentComic = null;
        let currentChapter = null;
        let currentChapterIndex = 0;
        let chapters = [];
        let readerZoom = 1;
        let currentGenre = null;
        let currentType = 'all';
        let currentOrder = 'latest';
        let genres = [];
        
        // --- UTIL: hide APK entries ---
        function isApkEntry(comic) {
            const t = (comic?.title || '').toLowerCase();
            const link = (comic?.link || comic?.href || '').toLowerCase();
            return t.includes('apk') || link.includes('/apk');
        }

        // --- UTIL: safe image (proxy + fallback, bisa contain/cover) ---
        function safeImg(url, seed, { contain = false, width = 0, height = 0 } = {}) {
            if (!url) return `https://picsum.photos/seed/${encodeURIComponent(seed)}/180/250.jpg`;
            const clean = url.replace(/^https?:\/\//, '');
            const params = [];
            if (contain) params.push('fit=contain');   // <— kunci biar full
            if (width) params.push('w=' + width);
            if (height) params.push('h=' + height);
            const q = params.length ? '&' + params.join('&') : '';
            return `https://images.weserv.nl/?url=${encodeURIComponent(clean)}${q}`;
        }

        // Helper untuk set route
        function setRoute(path, state = {}) {
            // pastikan selalu berakhiran "/"
            let p = path.replace(/\/+$/, '') + '/';
            const url = ROOT_PATH.replace(/\/+$/, '/') + p.replace(/^\/+/, '');
            history.pushState(state, '', url);
        }

        window.addEventListener('popstate', (e) => {
            // Handle back/forward
            const st = e.state || {};
            if (st.view === 'detail' && st.slug) {
                loadComicDetail(st.originalLink || `/manga/${st.slug}/`, { coverFromCard: st.cover || '' });
            } else if (st.view === 'section' && st.section) {
                navigateToSection(st.section);
            } else {
                // fallback ke beranda
                navigateToSection('home');
            }
        });

        // Convert link/href dari kartu/list/search ke endpoint detail API yang valid
        function toDetailUrl(linkOrHref = '') {
            if (!linkOrHref) return null;

            // Normalisasi: ambil slug akhir (tanpa leading/trailing slash)
            const clean = (s) => s.replace(/^https?:\/\/[^/]+/,'').replace(/^\/+|\/+$/g,'');

            let p = clean(linkOrHref);

            // /manga/xyz/ -> /comic/comic/xyz
            if (p.startsWith('manga/')) {
                const slug = p.replace(/^manga\/|\/$/g,'');
                return `${BASE}/comic/comic/${slug}`;
            }

            // /detail-komik/xyz/ -> /comic/comic/xyz
            if (p.startsWith('detail-komik/')) {
                const slug = p.replace(/^detail-komik\/|\/$/g,'');
                return `${BASE}/comic/comic/${slug}`;
            }

            // Sudah format /comic/comic/xyz -> pakai langsung
            if (p.startsWith('comic/comic/')) {
                return `${BASE}/${p}`;
            }

            // Fallback: anggap p itu slug langsung
            return `${BASE}/comic/comic/${p.replace(/\/$/,'')}`;
        }

        // Helper fetch dgn timeout + error parsing
        async function fetchJSON(url, {timeoutMs = 12000} = {}) {
            const ctl = new AbortController();
            const to = setTimeout(() => ctl.abort(), timeoutMs);
            try {
                const res = await fetch(url, {
                    signal: ctl.signal,
                    headers: { 'accept': 'application/json' },
                    mode: 'cors',
                    cache: 'no-store'
                });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                return await res.json();
            } finally {
                clearTimeout(to);
            }
        }

        // Tampilkan toast error user-friendly
        function showErrorToast(msg = 'Terjadi kesalahan saat memuat detail komik') {
            const el = document.getElementById('toast');
            if (!el) return;
            el.textContent = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        // Render detail + chapter list
        async function loadComicDetail(linkOrHref, { retry = 1, coverFromCard = '' } = {}) {
            const detailUrl = toDetailUrl(linkOrHref);
            if (!detailUrl) return showErrorToast();

            // UI: buka panel detail + tampilkan loader
            const section = document.getElementById('comicDetailSection');
            const coverEl = document.getElementById('comicDetailCover');
            const titleEl = document.getElementById('comicDetailTitle');
            const descEl = document.getElementById('comicDetailDescription');
            const chapterListEl = document.getElementById('chapterList');

            // Hide all sections
            sections.forEach(s => s.style.display = 'none');
            comicReaderSection.classList.remove('active');
            
            // Show comic detail
            section.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);

            // set cover dari kartu (langsung, tanpa nunggu fetch detail)
            if (coverEl && coverFromCard) coverEl.src = coverFromCard;

            if (chapterListEl) chapterListEl.innerHTML = `
                <div class="loading"><div class="spinner"></div></div>
            `;

            try {
                const data = await fetchJSON(detailUrl);

                // Data yang diharapkan: { title, synopsis, chapters: [{chapter, link}, ...] }
                const title = data.title || 'Tanpa judul';
                const synopsis = (data.synopsis || '').replace(/\n/g,'<br>');
                const chapters = Array.isArray(data.chapters) ? data.chapters : [];

                // Render meta/cover (pakai placeholder kalau API detail tidak kirim cover)
                if (titleEl) titleEl.textContent = title;
                if (descEl) descEl.innerHTML = synopsis;

                // Update comic detail meta
                document.getElementById('comicDetailType').textContent = data.type || 'Manga';
                document.getElementById('comicDetailGenre').textContent = data.genre || 'Action';

                // Render chapters (urut terbaru -> terlama)
                if (chapterListEl) {
                    if (!chapters.length) {
                        chapterListEl.innerHTML = '<div style="opacity:.7">Belum ada chapter.</div>';
                    } else {
                        chapterListEl.innerHTML = chapters
                            .map((c, idx) => {
                                const chName = c.chapter || `Chapter ${chapters.length - idx}`;
                                const chLink = c.link || '';
                                return `
                                    <div class="chapter-item" data-chapter-link="${chLink}">
                                        <span class="chapter-number">${chName}</span>
                                        <span class="chapter-date">—</span>
                                    </div>
                                `;
                            })
                            .join('');
                    }

                    // Click chapter → load chapter
                    chapterListEl.querySelectorAll('.chapter-item').forEach(it => {
                        it.addEventListener('click', () => {
                            const ch = it.getAttribute('data-chapter-link');
                            if (ch) {
                                loadChapter(ch);
                            } else {
                                showErrorToast('Link chapter tidak tersedia');
                            }
                        });
                    });
                }
                
                // Store current comic data
                currentComic = data;
                currentChapters = chapters;
                
                // Check if bookmarked
                const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
                const slug = linkOrHref.replace(/^\/+|\/+$/g, '');
                const isBookmarked = bookmarks.some(b => b.slug === slug);
                document.getElementById('bookmarkBtn').innerHTML = isBookmarked ? 
                    '<i class="fas fa-bookmark"></i> Hapus Tanda' : 
                    '<i class="fas fa-bookmark"></i> Tandai';
            } catch (err) {
                // Retry ringan untuk jaringan putus singkat
                if (retry > 0) {
                    return loadComicDetail(linkOrHref, {retry: retry - 1, coverFromCard});
                }
                console.error('Detail gagal:', err);
                showErrorToast('Terjadi kesalahan saat memuat detail komik');
            }
        }

        // Pastikan kartu komik klik → panggil loadComicDetail
        function attachCardOpenDetail(container) {
            container?.querySelectorAll('.comic-card').forEach(card => {
                const link = card.getAttribute('data-link') || card.dataset.link || '';
                const cover = card.getAttribute('data-cover') || '';
                const slug  = (link.replace(/^\/+|\/+$/g,'').split('/').pop()) || 'komik';

                card.addEventListener('click', () => {
                    // set route dengan trailing slash
                    setRoute(`komik/${encodeURIComponent(slug)}`, { view:'detail', slug, originalLink: link, cover });
                    // load detail
                    loadComicDetail(link, { coverFromCard: cover });
                });
            });
        }

        // Load Chapter
        async function loadChapter(chapterLink) {
            // Hide comic detail
            comicDetailSection.classList.remove('active');
            
            // Show comic reader
            comicReaderSection.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Update reader title
            document.getElementById('readerTitle').textContent = `${currentComic.title} - ${chapterLink}`;
            
            // Show loading
            const readerContent = document.getElementById('readerContent');
            readerContent.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            // Reset zoom
            readerZoom = 1;
            
            try {
                const data = await fetchJSON(`${API_BASE_URL}/chapter/${chapterLink}`);
                
                if (data.images && data.images.length > 0) {
                    readerContent.innerHTML = '';
                    
                    data.images.forEach(image => {
                        const img = document.createElement('img');
                        img.src = image;
                        img.className = 'reader-image';
                        img.style.transform = `scale(${readerZoom})`;
                        readerContent.appendChild(img);
                    });
                    
                    // Update chapter navigation
                    const currentChapterIndex = currentChapters.findIndex(c => c.link === chapterLink);
                    document.getElementById('prevChapterBtn').disabled = currentChapterIndex === 0;
                    document.getElementById('nextChapterBtn').disabled = currentChapterIndex === currentChapters.length - 1;
                } else {
                    readerContent.innerHTML = '<p>Gagal memuat chapter</p>';
                }
            } catch (error) {
                console.error('Error loading chapter:', error);
                readerContent.innerHTML = '<p>Terjadi kesalahan saat memuat chapter</p>';
            }
        }

        // Close Reader
        function closeReader() {
            comicReaderSection.classList.remove('active');
            comicDetailSection.classList.add('active');
        }

        // Update Reader Zoom
        function updateReaderZoom() {
            const images = document.querySelectorAll('.reader-image');
            images.forEach(img => {
                img.style.transform = `scale(${readerZoom})`;
            });
        }

        // ======= 1) Gambar cover asli (tanpa ?resize, tanpa fit/w/h) =======
        function imgOriginal(url, seed) {
            if (!url) return `https://picsum.photos/seed/${encodeURIComponent(seed)}/180/250.jpg`;
            const noProto = url.split('?')[0].replace(/^https?:\/\//,''); // buang query
            return `https://images.weserv.nl/?url=${encodeURIComponent(noProto)}`;
        }

        // Override card builders agar simpan cover asli
        window.createComicCard = function (comic) {
            if (isApkEntry(comic)) return document.createTextNode('');
            const card = document.createElement('div');
            card.className = 'comic-card';
            const link = comic.link || '';
            const imgSrc = imgOriginal(comic.image, link);
            card.setAttribute('data-link', link);
            card.setAttribute('data-cover', imgSrc);

            card.innerHTML = `
                <img class="comic-cover" alt="${comic.title||''}" src="${imgSrc}"
                     loading="lazy" onerror="this.onerror=null;this.src='https://picsum.photos/seed/${encodeURIComponent(link)}/180/250.jpg'">
                <div class="comic-info">
                    <h3 class="comic-title">${comic.title||''}</h3>
                    <div class="comic-meta">
                        <span class="comic-type">${comic.type||'Manga'}</span>
                        <span>${comic.chapter||''}</span>
                    </div>
                </div>`;
            return card;
        };

        window.createSearchComicCard = function (comic) {
            if (isApkEntry(comic)) return document.createTextNode('');
            const card = document.createElement('div');
            card.className = 'comic-card';
            const href = comic.href || '';
            const imgSrc = imgOriginal(comic.thumbnail, href);
            card.setAttribute('data-link', href);
            card.setAttribute('data-cover', imgSrc);

            card.innerHTML = `
                <img class="comic-cover" alt="${comic.title||''}" src="${imgSrc}"
                     loading="lazy" onerror="this.onerror=null;this.src='https://picsum.photos/seed/${encodeURIComponent(href)}/180/250.jpg'">
                <div class="comic-info">
                    <h3 class="comic-title">${comic.title||''}</h3>
                    <div class="comic-meta">
                        <span class="comic-type">${comic.type||'Manga'}</span>
                        <span>${comic.genre||''}</span>
                    </div>
                </div>`;
            return card;
        };

        // Saring data.comics / data.data di semua loader
        function appendFiltered(container, list, isSearch = false) {
            const maker = isSearch ? window.createSearchComicCard : window.createComicCard;
            const filtered = (list || []).filter(c => !isApkEntry(c));
            if (!filtered.length) {
                container.innerHTML = '<p>Tidak ada komik</p>';
                return;
            }
            filtered.forEach(c => {
                const node = maker(c);
                if (node && node.nodeType !== 3) container.appendChild(node);
            });
        }

        // ======= 2) Home cuma "Terbaru" + jadikan row Netflix =======
        function ensureRowUI() {
            const latest = document.getElementById('latestComics');
            if (!latest) return;
            latest.classList.add('row-scroll'); // jadikan baris
            // Inject controls kalau belum ada
            if (!document.getElementById('autoPlayBtn')) {
                const header = latest.previousElementSibling; // section-header
                if (header?.classList.contains('section-header')) {
                    const ctl = document.createElement('div');
                    ctl.className = 'row-controls';
                    ctl.innerHTML = `
                        <button class="btn btn-secondary" id="autoPlayBtn">▶ Putar</button>
                        <label for="autoSpeed">Kecepatan</label>
                        <input type="range" id="autoSpeed" min="1" max="10" value="4">`;
                    header.appendChild(ctl);
                }
            }
            // Sembunyikan blok populer/trending kalau masih ada
            ['popularComics','trendingComics'].forEach(id=>{
                const el = document.getElementById(id);
                if (el) el.parentElement.style.display='none';
            });
        }

        // Overwrite loader home: hanya panggil terbaru
        window.loadHomeContent = function () {
            ensureRowUI();
            loadLatestComicsPreview();
        };

        // ======= 3) Auto-scroll Netflix row =======
        let autoTimer = null, autoPlaying = false;

        function startAutoScroll() {
            stopAutoScroll();
            const row = document.getElementById('latestComics');
            const speed = Number(document.getElementById('autoSpeed')?.value || 4); // 1..10
            const step = 4 + speed * 4; // pixel per tick
            autoPlaying = true;
            const btn = document.getElementById('autoPlayBtn');
            if (btn) btn.textContent = '⏸ Jeda';

            autoTimer = setInterval(() => {
                if (!row) return;
                row.scrollLeft += step;
                // loop ke awal jika sudah mentok
                if (row.scrollLeft + row.clientWidth >= row.scrollWidth - 2) {
                    row.scrollLeft = 0;
                }
            }, 30);
        }
        function stopAutoScroll() {
            autoPlaying = false;
            if (autoTimer) clearInterval(autoTimer);
            autoTimer = null;
            const btn = document.getElementById('autoPlayBtn');
            if (btn) btn.textContent = '▶ Putar';
        }

        // Hook tombol/slider (setelah DOM siap)
        document.addEventListener('click', (e)=>{
            if (e.target && e.target.id === 'autoPlayBtn') {
                autoPlaying ? stopAutoScroll() : startAutoScroll();
            }
        });
        document.addEventListener('input', (e)=>{
            if (e.target && e.target.id === 'autoSpeed') {
                if (autoPlaying) startAutoScroll(); // restart dengan speed baru
            }
        });

        // Pause saat user interaksi manual
        document.addEventListener('DOMContentLoaded', ()=>{
            const row = document.getElementById('latestComics');
            if (!row) return;
            ['pointerdown','wheel','touchstart','mouseenter'].forEach(ev=>{
                row.addEventListener(ev, ()=> autoPlaying && stopAutoScroll(), {passive:true});
            });
        });

        // ======= 4) Loader terbaru -> append ke row + attach detail =======
        window.loadLatestComicsPreview = function () {
            const container = document.getElementById('latestComics');
            if (!container) return;
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            fetch(`${API_BASE_URL}/terbaru`)
                .then(r => r.json())
                .then(data => {
                    container.innerHTML = '';
                    appendFiltered(container, data.comics);
                    attachCardOpenDetail(container);
                    ensureRowUI(); // pastikan kelas/controls ada
                })
                .catch(() => container.innerHTML = '<p>Terjadi kesalahan saat memuat komik terbaru</p>');
        };

        // --- Patch kecil di loader-list: ganti forEach -> appendFiltered ---
        // Contoh (lakukan serupa di loadX lainnya):
        window.loadPopularComicsPreview = function () {
            const container = document.getElementById('popularComics');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            fetch(`${API_BASE_URL}/populer`)
                .then(r => r.json()).then(data => {
                    container.innerHTML = '';
                    appendFiltered(container, data.comics);
                    attachCardOpenDetail(container);
                })
                .catch(() => container.innerHTML = '<p>Terjadi kesalahan saat memuat komik populer</p>');
        };

        window.loadLatestComics = function (page=1) {
            const container = document.getElementById('allLatestComics');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            fetch(`${API_BASE_URL}/terbaru?page=${page}`).then(r=>r.json()).then(data=>{
                container.innerHTML='';
                appendFiltered(container, data.comics);
                attachCardOpenDetail(container);
                createPagination('terbaru', data.pagination || { current_page: page, total_pages: 5 });
            }).catch(()=>container.innerHTML='<p>Terjadi kesalahan saat memuat komik terbaru</p>');
        };

        window.loadPopularComics = function (page=1) {
            const container = document.getElementById('allPopularComics');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            fetch(`${API_BASE_URL}/populer?page=${page}`).then(r=>r.json()).then(data=>{
                container.innerHTML='';
                appendFiltered(container, data.comics);
                attachCardOpenDetail(container);
                createPagination('popular', data.pagination || { current_page: page, total_pages: 5 });
            }).catch(()=>container.innerHTML='<p>Terjadi kesalahan saat memuat komik populer</p>');
        };

        window.performSearch = function () {
            const q = searchInput.value.trim();
            if (!q) return;
            sections.forEach(s => s.style.display = 'none');
            comicDetailSection.classList.remove('active');
            comicReaderSection.classList.remove('active');
            const target = document.getElementById('searchResultsSection');
            target.style.display = 'block';
            const container = document.getElementById('searchResults');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            fetch(`${API_BASE_URL}/search?q=${encodeURIComponent(q)}`).then(r=>r.json()).then(data=>{
                container.innerHTML='';
                appendFiltered(container, data.data, true);
                attachCardOpenDetail(container);
            }).catch(()=>container.innerHTML='<p>Terjadi kesalahan saat mencari komik</p>');
        };

        // Trending fallback: jika /trending gagal, ambil dari /populer
        window.loadTrendingComicsPreview = function () {
            const container = document.getElementById('trendingComics');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            fetch(`${API_BASE_URL}/trending`).then(r=>r.json()).then(data=>{
                container.innerHTML='';
                const list = data.trending && data.trending.length ? data.trending : (data.comics || []);
                appendFiltered(container, list);
                attachCardOpenDetail(container);
            }).catch(()=>{
                // full fallback
                fetch(`${API_BASE_URL}/populer`).then(r=>r.json()).then(data=>{
                    container.innerHTML='';
                    appendFiltered(container, data.comics);
                    attachCardOpenDetail(container);
                }).catch(()=>container.innerHTML='<p>Tidak ada komik trending</p>');
            });
        };

        window.loadTrendingComics = function () {
            const container = document.getElementById('allTrendingComics');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            fetch(`${API_BASE_URL}/trending`).then(r=>r.json()).then(data=>{
                container.innerHTML='';
                const list = data.trending && data.trending.length ? data.trending : (data.comics || []);
                appendFiltered(container, list);
                attachCardOpenDetail(container);
            }).catch(()=>{
                fetch(`${API_BASE_URL}/populer`).then(r=>r.json()).then(data=>{
                    container.innerHTML='';
                    appendFiltered(container, data.comics);
                    attachCardOpenDetail(container);
                }).catch(()=>container.innerHTML='<p>Tidak ada komik trending</p>');
            });
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            loadHomeContent();
            setupEventListeners();
            loadGenres();
            
            // Burger Menu
            document.getElementById('burgerBtn').addEventListener('click', () => {
                const menu = document.querySelector('nav .nav-menu');
                menu.classList.toggle('open');
            });
        });
        
        // Setup Event Listeners
        function setupEventListeners() {
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.getAttribute('data-section');
                    navigateToSection(section);
                    
                    // Close burger menu on mobile after navigation
                    const menu = document.querySelector('nav .nav-menu');
                    if (menu.classList.contains('open')) {
                        menu.classList.remove('open');
                    }
                });
            });
            
            // View All Buttons
            viewAllBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = btn.getAttribute('data-section');
                    navigateToSection(section);
                });
            });
            
            // Search Form
            searchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                performSearch();
            });
            
            // Advanced Search Toggle
            advancedSearchToggle.addEventListener('click', () => {
                advancedSearch.classList.toggle('active');
            });
            
            // Apply Advanced Search
            applyAdvancedSearch.addEventListener('click', () => {
                performAdvancedSearch();
            });
            
            // Reader Controls
            document.getElementById('zoomInBtn').addEventListener('click', () => {
                readerZoom += 0.1;
                updateReaderZoom();
            });
            
            document.getElementById('zoomOutBtn').addEventListener('click', () => {
                readerZoom -= 0.1;
                if (readerZoom < 0.5) readerZoom = 0.5;
                updateReaderZoom();
            });
            
            document.getElementById('fullscreenBtn').addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    comicReaderSection.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            });
            
            document.getElementById('closeReaderBtn').addEventListener('click', () => {
                closeReader();
            });
            
            // Chapter Navigation
            document.getElementById('prevChapterBtn').addEventListener('click', () => {
                const currentChapterIndex = currentChapters.findIndex(c => c.link === currentChapter);
                if (currentChapterIndex > 0) {
                    loadChapter(currentChapters[currentChapterIndex - 1].link);
                }
            });
            
            document.getElementById('nextChapterBtn').addEventListener('click', () => {
                const currentChapterIndex = currentChapters.findIndex(c => c.link === currentChapter);
                if (currentChapterIndex < currentChapters.length - 1) {
                    loadChapter(currentChapters[currentChapterIndex + 1].link);
                }
            });
            
            // Bookmark Button
            document.getElementById('bookmarkBtn').addEventListener('click', () => {
                if (currentComic) {
                    const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
                    const slug = currentComic.slug || '';
                    const exists = bookmarks.some(b => b.slug === slug);
                    
                    if (exists) {
                        // Remove bookmark
                        const updatedBookmarks = bookmarks.filter(b => b.slug !== slug);
                        localStorage.setItem('bookmarks', JSON.stringify(updatedBookmarks));
                        showErrorToast('Komik dihapus dari bookmark');
                        document.getElementById('bookmarkBtn').innerHTML = '<i class="fas fa-bookmark"></i> Tandai';
                    } else {
                        // Add bookmark
                        bookmarks.push({
                            slug: slug,
                            title: currentComic.title,
                            cover: currentComic.cover,
                            type: currentComic.type
                        });
                        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
                        showErrorToast('Komik ditambahkan ke bookmark');
                        document.getElementById('bookmarkBtn').innerHTML = '<i class="fas fa-bookmark"></i> Hapus Tanda';
                    }
                }
            });
            
            // Share Button
            document.getElementById('shareBtn').addEventListener('click', () => {
                if (navigator.share && currentComic) {
                    navigator.share({
                        title: currentComic.title,
                        text: `Baca komik ${currentComic.title} di Komik Reader`,
                        url: window.location.href
                    }).catch(err => console.log('Error sharing:', err));
                } else {
                    // Fallback - copy to clipboard
                    const dummy = document.createElement('input');
                    document.body.appendChild(dummy);
                    dummy.value = window.location.href;
                    dummy.select();
                    document.execCommand('copy');
                    document.body.removeChild(dummy);
                    showErrorToast('Link berhasil disalin!');
                }
            });
        }
        
        // Navigation
        function navigateToSection(section) {
            // Update active nav link
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === section) {
                    link.classList.add('active');
                }
            });
            
            // Hide all sections
            sections.forEach(s => s.style.display = 'none');
            comicDetailSection.classList.remove('active');
            comicReaderSection.classList.remove('active');
            
            // Show target section
            currentSection = section;
            
            switch(section) {
                case 'home':
                    document.getElementById('homeSection').style.display = 'block';
                    loadHomeContent();
                    break;
                case 'terbaru':
                    document.getElementById('terbaruSection').style.display = 'block';
                    loadLatestComics();
                    break;
                case 'populer':
                    document.getElementById('populerSection').style.display = 'block';
                    loadPopularComics();
                    break;
                case 'trending':
                    document.getElementById('trendingSection').style.display = 'block';
                    loadTrendingComics();
                    break;
                case 'browse':
                    document.getElementById('browseSection').style.display = 'block';
                    loadBrowseComics();
                    break;
            }
            
            // Set route dengan trailing slash
            setRoute(section, { view: 'section', section });
            
            window.scrollTo(0, 0);
        }
        
        // Load Genres
        function loadGenres() {
            fetch(`${API_BASE_URL}/genres`)
                .then(response => response.json())
                .then(data => {
                    genres = Object.values(data).filter(item => item.value && item.name);
                    
                    // Update genre filter in browse section
                    const genreFilterContainer = document.getElementById('genreFilter');
                    genreFilterContainer.innerHTML = '';
                    
                    // Add "All" button
                    const allBtn = document.createElement('button');
                    allBtn.className = 'genre-btn active';
                    allBtn.textContent = 'Semua';
                    allBtn.setAttribute('data-genre', 'all');
                    allBtn.addEventListener('click', () => {
                        document.querySelectorAll('.genre-btn').forEach(btn => btn.classList.remove('active'));
                        allBtn.classList.add('active');
                        currentGenre = null;
                        loadBrowseComics();
                    });
                    genreFilterContainer.appendChild(allBtn);
                    
                    // Add genre buttons
                    genres.forEach(genre => {
                        const genreBtn = document.createElement('button');
                        genreBtn.className = 'genre-btn';
                        genreBtn.textContent = genre.name;
                        genreBtn.setAttribute('data-genre', genre.value);
                        genreBtn.addEventListener('click', () => {
                            document.querySelectorAll('.genre-btn').forEach(btn => btn.classList.remove('active'));
                            genreBtn.classList.add('active');
                            currentGenre = genre.value;
                            loadBrowseComics();
                        });
                        genreFilterContainer.appendChild(genreBtn);
                    });
                    
                    // Setup type filter buttons
                    document.querySelectorAll('.type-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            currentType = btn.getAttribute('data-type');
                            loadBrowseComics();
                        });
                    });
                })
                .catch(error => {
                    console.error('Error loading genres:', error);
                });
        }
        
        // Load Browse Comics
        function loadBrowseComics(page = 1) {
            const container = document.getElementById('browseComics');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            // Build query parameters
            const params = new URLSearchParams();
            if (currentType !== 'all') params.append('type', currentType);
            if (currentGenre) params.append('genre', currentGenre);
            if (currentOrder !== 'latest') params.append('order', currentOrder);
            params.append('page', page);
            
            fetch(`${API_BASE_URL}/browse?${params.toString()}`)
                .then(response => response.json())
                .then(data => {
                    container.innerHTML = '';
                    if (data.comics && data.comics.length > 0) {
                        appendFiltered(container, data.comics);
                        attachCardOpenDetail(container);
                        
                        // Create pagination
                        createPagination('browse', data.pagination || { current_page: page, total_pages: 5 });
                    } else {
                        container.innerHTML = '<p>Tidak ada komik yang ditemukan</p>';
                    }
                })
                .catch(error => {
                    console.error('Error loading browse comics:', error);
                    container.innerHTML = '<p>Terjadi kesalahan saat memuat komik</p>';
                });
        }
        
        // Perform Advanced Search
        function performAdvancedSearch() {
            const query = searchInput.value.trim();
            const type = document.getElementById('filterType').value;
            const genre = document.getElementById('filterGenre').value;
            const order = document.getElementById('filterOrder').value;
            
            if (!query) {
                showErrorToast('Masukkan kata kunci pencarian');
                return;
            }
            
            // Hide all sections
            sections.forEach(s => s.style.display = 'none');
            comicDetailSection.classList.remove('active');
            comicReaderSection.classList.remove('active');
            
            // Show search results
            document.getElementById('searchResultsSection').style.display = 'block';
            
            const container = document.getElementById('searchResults');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            // Build query parameters
            const params = new URLSearchParams();
            params.append('q', query);
            if (type !== 'all') params.append('type', type);
            if (genre !== 'all') params.append('genre', genre);
            if (order !== 'latest') params.append('order', order);
            
            fetch(`${API_BASE_URL}/search?${params.toString()}`)
                .then(response => response.json())
                .then(data => {
                    container.innerHTML = '';
                    if (data.data && data.data.length > 0) {
                        appendFiltered(container, data.data, true);
                        attachCardOpenDetail(container);
                    } else {
                        container.innerHTML = '<p>Tidak ada hasil untuk pencarian ini</p>';
                    }
                    
                    // Close advanced search
                    advancedSearch.classList.remove('active');
                })
                .catch(error => {
                    console.error('Error searching comics:', error);
                    container.innerHTML = '<p>Terjadi kesalahan saat mencari komik</p>';
                });
        }
        
        // Load Genre Comics
        function loadGenreComics(genre, page = 1) {
            // Hide all sections
            sections.forEach(s => s.style.display = 'none');
            comicDetailSection.classList.remove('active');
            comicReaderSection.classList.remove('active');
            
            // Show genre section
            document.getElementById('genreSection').style.display = 'block';
            document.getElementById('genreTitle').textContent = `Komik Genre ${genre}`;
            
            const container = document.getElementById('genreComics');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            fetch(`${API_BASE_URL}/genre/${encodeURIComponent(genre)}?page=${page}`)
                .then(response => response.json())
                .then(data => {
                    container.innerHTML = '';
                    if (data.comics && data.comics.length > 0) {
                        appendFiltered(container, data.comics);
                        attachCardOpenDetail(container);
                        
                        // Create pagination
                        createPagination('genre', data.pagination || { current_page: page, total_pages: 5 });
                    } else {
                        container.innerHTML = `<p>Tidak ada komik dengan genre ${genre}</p>`;
                    }
                })
                .catch(error => {
                    console.error('Error loading genre comics:', error);
                    container.innerHTML = `<p>Terjadi kesalahan saat memuat komik genre ${genre}</p>`;
                });
        }
        
        // Create Pagination
        function createPagination(type, pagination) {
            const container = document.getElementById(`${type}Pagination`);
            container.innerHTML = '';
            
            if (!pagination) return;
            
            const { current_page, total_pages } = pagination;
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.disabled = current_page === 1;
            prevBtn.addEventListener('click', () => {
                if (current_page > 1) {
                    loadPage(type, current_page - 1);
                }
            });
            container.appendChild(prevBtn);
            
            // Page numbers
            const startPage = Math.max(1, current_page - 2);
            const endPage = Math.min(total_pages, current_page + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'page-btn';
                if (i === current_page) {
                    pageBtn.classList.add('active');
                }
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    loadPage(type, i);
                });
                container.appendChild(pageBtn);
            }
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.disabled = current_page === total_pages;
            nextBtn.addEventListener('click', () => {
                if (current_page < total_pages) {
                    loadPage(type, current_page + 1);
                }
            });
            container.appendChild(nextBtn);
        }
        
        // Load Page
        function loadPage(type, page) {
            currentPage[type] = page;
            
            switch(type) {
                case 'terbaru':
                    loadLatestComics(page);
                    break;
                case 'populer':
                    loadPopularComics(page);
                    break;
                case 'browse':
                    loadBrowseComics(page);
                    break;
                case 'search':
                    performSearchWithPage(page);
                    break;
                case 'genre':
                    // Get current genre from title
                    const genreTitle = document.getElementById('genreTitle').textContent;
                    const genre = genreTitle.replace('Komik Genre ', '');
                    loadGenreComics(genre, page);
                    break;
            }
        }
        
        // Perform Search with Page
        function performSearchWithPage(page) {
            const query = searchInput.value.trim();
            if (!query) return;
            
            const container = document.getElementById('searchResults');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            fetch(`${API_BASE_URL}/search?q=${encodeURIComponent(query)}&page=${page}`)
                .then(response => response.json())
                .then(data => {
                    container.innerHTML = '';
                    if (data.data && data.data.length > 0) {
                        appendFiltered(container, data.data, true);
                        attachCardOpenDetail(container);
                    } else {
                        container.innerHTML = '<p>Tidak ada hasil untuk pencarian ini</p>';
                    }
                })
                .catch(error => {
                    console.error('Error searching comics:', error);
                    container.innerHTML = '<p>Terjadi kesalahan saat mencari komik</p>';
                });
        }
    </script>
</body>
</html>
