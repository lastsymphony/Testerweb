<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Katheryne - Space Games</title>
  <style>
    :root { --app-vh: 1vh; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; background: #000; overflow: hidden; font-family: 'Inter', system-ui, sans-serif; }
    
    body {
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      position: relative;
    }

    .stars-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    /* Game Menu Styles */
    #game-menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 100;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
    }

    #game-menu.hidden {
      display: none;
    }

    .menu-title {
      font-size: 48px;
      font-weight: 800;
      margin-bottom: 40px;
      background: linear-gradient(90deg, #a78bfa, #60a5fa, #f472b6);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      max-width: 900px;
      width: 100%;
      padding: 0 20px;
    }

    .game-card {
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(96, 165, 250, 0.2));
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      user-select: none;
      -webkit-user-select: none;
    }

    .game-card:hover {
      transform: translateY(-10px) scale(1.05);
      box-shadow: 0 20px 40px rgba(167, 139, 250, 0.4);
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.3), rgba(96, 165, 250, 0.3));
      border-color: rgba(255, 255, 255, 0.5);
    }

    .game-card:active {
      transform: translateY(-5px) scale(1.02);
    }

    .game-icon {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
    }

    .game-name {
      font-size: 24px;
      font-weight: 700;
      color: white;
      margin-bottom: 10px;
    }

    .game-description {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.4;
    }

    /* Game Container Styles */
    #game-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 50;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #game-container.active {
      display: flex;
    }

    #game-ui {
      position: absolute;
      top: 20px;
      left: 20px;
      color: white;
      font-size: 20px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      z-index: 60;
      pointer-events: none;
    }

    #game-over, #game-start {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: white;
      z-index: 70;
      background: rgba(0, 0, 0, 0.9);
      padding: 40px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.2);
      pointer-events: auto;
      opacity: 0;
      transition: opacity 0.5s ease;
      min-width: 300px;
    }

    #game-over.visible, #game-start.visible {
      opacity: 1;
    }

    #game-over h2, #game-start h2 {
      font-size: 36px;
      margin-bottom: 20px;
      background: linear-gradient(90deg, #a78bfa, #60a5fa);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    #game-over p, #game-start p {
      margin-bottom: 25px;
      font-size: 18px;
      color: rgba(255, 255, 255, 0.9);
    }

    .game-button {
      display: inline-block;
      padding: 15px 30px;
      background: linear-gradient(90deg, #a78bfa, #60a5fa);
      color: white;
      font-weight: 600;
      border-radius: 50px;
      text-decoration: none;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(167, 139, 250, 0.4);
      border: none;
      cursor: pointer;
      font-size: 18px;
      margin: 10px;
      user-select: none;
      -webkit-user-select: none;
    }

    .game-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(167, 139, 250, 0.6);
    }

    .back-button {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 80;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 10px 20px;
      font-size: 16px;
    }

    /* Game specific styles */
    .spaceship {
      position: absolute;
      width: 60px;
      height: 60px;
      z-index: 55;
      pointer-events: none;
      transition: all 0.1s ease-out;
    }

    .asteroid {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #8b7355, #3e342a);
      box-shadow: inset -5px -5px 10px rgba(0, 0, 0, 0.5);
      z-index: 54;
      pointer-events: none;
    }

    .star-game {
      position: absolute;
      width: 30px;
      height: 30px;
      background: radial-gradient(circle, #ffeb3b, #ff9800);
      clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
      z-index: 53;
      pointer-events: none;
    }

    .bullet {
      position: absolute;
      width: 6px;
      height: 15px;
      background: linear-gradient(to top, #ff0, #f00);
      border-radius: 50%;
      z-index: 54;
      pointer-events: none;
    }

    .explosion {
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255, 165, 0, 0.8), rgba(255, 0, 0, 0.4), transparent);
      z-index: 56;
      pointer-events: none;
      animation: explode 0.5s ease-out forwards;
    }

    @keyframes explode {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }

    .score-popup {
      position: absolute;
      color: #ffeb3b;
      font-weight: bold;
      font-size: 28px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      z-index: 57;
      pointer-events: none;
      animation: scoreFloat 1s ease-out forwards;
    }

    @keyframes scoreFloat {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-60px); opacity: 0; }
    }

    #instructions {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      text-align: center;
      font-size: 18px;
      z-index: 60;
      pointer-events: none;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px 30px;
      border-radius: 30px;
      backdrop-filter: blur(10px);
    }

    /* Memory game specific */
    .memory-grid {
      display: grid;
      grid-template-columns: repeat(4, 90px);
      grid-template-rows: repeat(4, 90px);
      gap: 15px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 55;
    }

    .memory-card {
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.4), rgba(96, 165, 250, 0.4));
      border: 3px solid rgba(255, 255, 255, 0.4);
      border-radius: 15px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 36px;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      user-select: none;
      -webkit-user-select: none;
    }

    .memory-card:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(167, 139, 250, 0.4);
    }

    .memory-card.flipped {
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.7), rgba(96, 165, 250, 0.7));
      transform: rotateY(180deg);
    }

    .memory-card.matched {
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.7), rgba(129, 199, 132, 0.7));
      animation: matchPulse 0.5s ease;
      border-color: rgba(76, 175, 80, 0.8);
    }

    @keyframes matchPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Background Stars -->
  <div class="stars-bg" id="stars-bg"></div>

  <!-- Game Menu -->
  <div id="game-menu">
    <h1 class="menu-title">üöÄ Space Games üåå</h1>
    <div class="games-grid">
      <div class="game-card" id="shooter-card">
        <div class="game-icon">üõ∏</div>
        <div class="game-name">Space Shooter</div>
        <div class="game-description">Shoot asteroids and survive in space</div>
      </div>
      <div class="game-card" id="dodger-card">
        <div class="game-icon">‚òÑÔ∏è</div>
        <div class="game-name">Asteroid Dodger</div>
        <div class="game-description">Dodge asteroids and survive as long as possible</div>
      </div>
      <div class="game-card" id="collector-card">
        <div class="game-icon">‚≠ê</div>
        <div class="game-name">Star Collector</div>
        <div class="game-description">Collect stars while avoiding space debris</div>
      </div>
      <div class="game-card" id="memory-card">
        <div class="game-icon">üß†</div>
        <div class="game-name">Space Memory</div>
        <div class="game-description">Match pairs of space objects</div>
      </div>
    </div>
  </div>

  <!-- Game Container -->
  <div id="game-container">
    <button class="game-button back-button" id="back-btn">‚Üê Menu</button>
    
    <div id="game-ui">
      <div>Score: <span id="score">0</span></div>
      <div id="game-stats"></div>
    </div>

    <div id="game-start">
      <h2 id="game-title">Game Title</h2>
      <p id="game-description">Game Description</p>
      <button class="game-button" id="start-btn">Start Game</button>
    </div>

    <div id="game-over">
      <h2>Game Over!</h2>
      <p>Your Score: <span id="final-score">0</span></p>
      <button class="game-button" id="restart-btn">Play Again</button>
      <button class="game-button" id="menu-btn">Menu</button>
    </div>

    <div id="instructions"></div>
  </div>

  <script>
    // Create background stars
    function createBackgroundStars() {
      const starsBg = document.getElementById('stars-bg');
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.width = Math.random() * 3 + 'px';
        star.style.height = star.style.width;
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        starsBg.appendChild(star);
      }
    }
    createBackgroundStars();

    // Game variables
    const gameMenu = document.getElementById('game-menu');
    const gameContainer = document.getElementById('game-container');
    const gameStart = document.getElementById('game-start');
    const gameOver = document.getElementById('game-over');
    const gameTitle = document.getElementById('game-title');
    const gameDescription = document.getElementById('game-description');
    const scoreElement = document.getElementById('score');
    const finalScoreElement = document.getElementById('final-score');
    const gameStats = document.getElementById('game-stats');
    const instructions = document.getElementById('instructions');
    const startBtn = document.getElementById('start-btn');
    const backBtn = document.getElementById('back-btn');
    const restartBtn = document.getElementById('restart-btn');
    const menuBtn = document.getElementById('menu-btn');

    let currentGame = null;
    let gameActive = false;
    let score = 0;
    let gameLoop = null;

    const games = {
      shooter: {
        title: 'Space Shooter',
        description: 'Shoot asteroids and survive in space',
        instructions: 'üéÆ Touch/Click to shoot ‚Ä¢ Drag to move',
        start: startShooterGame,
        update: updateShooterGame
      },
      dodger: {
        title: 'Asteroid Dodger',
        description: 'Dodge asteroids and survive as long as possible',
        instructions: 'üéÆ Touch/Click and drag to move ‚Ä¢ Avoid all asteroids',
        start: startDodgerGame,
        update: updateDodgerGame
      },
      collector: {
        title: 'Star Collector',
        description: 'Collect stars while avoiding space debris',
        instructions: 'üéÆ Touch/Click and drag to move ‚Ä¢ Collect stars ‚Ä¢ Avoid debris',
        start: startCollectorGame,
        update: updateCollectorGame
      },
      memory: {
        title: 'Space Memory',
        description: 'Match pairs of space objects',
        instructions: 'üéÆ Click cards to flip ‚Ä¢ Match all pairs to win',
        start: startMemoryGame,
        update: () => {}
      }
    };

    // Add event listeners to game cards
    document.getElementById('shooter-card').addEventListener('click', (e) => selectGame('shooter', e));
    document.getElementById('dodger-card').addEventListener('click', (e) => selectGame('dodger', e));
    document.getElementById('collector-card').addEventListener('click', (e) => selectGame('collector', e));
    document.getElementById('memory-card').addEventListener('click', (e) => selectGame('memory', e));

    // --- ganti bagian event listener tombol ---
    startBtn.addEventListener('click', (e) => startCurrentGame(e));
    restartBtn.addEventListener('click', (e) => restartGame(e));
    menuBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      backToMenu();
    });
    // backBtn tetap sama
    backBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      backToMenu();
    });

    function selectGame(gameType, e) {
      console.log('Selecting game:', gameType);
      
      // cegah bubbling klik
      if (e) e.stopPropagation();
      
      currentGame = gameType;
      const game = games[gameType];
      
      if (!game) {
        console.error('Game not found:', gameType);
        return;
      }
      
      // Hide menu, show game container
      gameMenu.classList.add('hidden');
      gameContainer.classList.add('active');
      
      // Set game info
      gameTitle.textContent = game.title;
      gameDescription.textContent = game.description;
      instructions.innerHTML = `<div>${game.instructions}</div>`;
      
      // Show start screen
      gameStart.classList.add('visible');
      gameOver.classList.remove('visible');
      
      // Reset score
      score = 0;
      scoreElement.textContent = score;
    }

    // --- perbaiki startCurrentGame ---
    function startCurrentGame(e) {
      console.log('Starting current game:', currentGame);

      // cegah bubbling klik (optional tapi aman)
      if (e) e.stopPropagation();

      // sembunyiin layar "press start"
      gameStart.classList.remove('visible');
      gameOver.classList.remove('visible');

      // reset loop lama kalau ada
      if (gameLoop) {
        cancelAnimationFrame(gameLoop);
        gameLoop = null;
      }

      // mulai game yang dipilih
      if (currentGame && games[currentGame]) {
        gameActive = true;
        games[currentGame].start();
      } else {
        console.error('No game selected');
      }
    }

    function backToMenu() {
      console.log('Back to menu');
      
      // Stop game loop
      if (gameLoop) {
        cancelAnimationFrame(gameLoop);
        gameLoop = null;
      }
      
      gameActive = false;
      currentGame = null;
      
      // Clear game elements
      const gameElements = gameContainer.querySelectorAll('.spaceship, .asteroid, .star-game, .bullet, .explosion, .score-popup, .memory-grid');
      gameElements.forEach(el => el.remove());
      
      // Show menu, hide game
      gameContainer.classList.remove('active');
      gameMenu.classList.remove('hidden');
    }

    // --- perbaiki restartGame ---
    function restartGame(e) {
      console.log('Restart game');

      if (e) e.stopPropagation();

      // sembunyikan layar game over
      gameOver.classList.remove('visible');

      // mulai ulang game aktif
      startCurrentGame();
    }

    function endGame() {
      console.log('Game over');
      gameActive = false;
      finalScoreElement.textContent = score;
      gameOver.classList.add('visible');
    }

    // ===== SPACE SHOOTER GAME =====
    let spaceship = null;
    let asteroids = [];
    let bullets = [];
    let explosions = [];
    let scorePopups = [];
    let spaceshipX = window.innerWidth / 2;
    let spaceshipY = window.innerHeight - 100;
    let canShoot = true;
    let shootCooldown = 0;
    let shooterLives = 3;

    function startShooterGame() {
      console.log('Starting shooter game');
      gameActive = true;
      score = 0;
      shooterLives = 3;
      scoreElement.textContent = score;
      gameStats.innerHTML = `<div>Lives: <span id="lives">${shooterLives}</span></div>`;
      
      clearGameObjects();
      createSpaceship();
      updateShooterGame();
    }

    function createSpaceship() {
      spaceship = document.createElement('div');
      spaceship.className = 'spaceship';
      spaceship.innerHTML = `
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <path d="M32 8 L40 40 L32 36 L24 40 Z" fill="#60a5fa" stroke="#a78bfa" stroke-width="2"/>
          <circle cx="32" cy="28" r="4" fill="#fff"/>
        </svg>
      `;
      spaceship.style.left = `${spaceshipX - 30}px`;
      spaceship.style.top = `${spaceshipY - 30}px`;
      gameContainer.appendChild(spaceship);
    }

    function createBullet() {
      if (!canShoot || !spaceship) return;
      
      const bullet = document.createElement('div');
      bullet.className = 'bullet';
      bullet.style.left = `${spaceshipX - 3}px`;
      bullet.style.top = `${spaceshipY - 30}px`;
      bullet.dataset.vy = -12;
      
      gameContainer.appendChild(bullet);
      bullets.push(bullet);
      
      canShoot = false;
      shootCooldown = 15;
    }

    function createAsteroid() {
      const asteroid = document.createElement('div');
      asteroid.className = 'asteroid';
      
      const x = Math.random() * window.innerWidth;
      const y = -40;
      const vx = (Math.random() - 0.5) * 3;
      const vy = 2 + Math.random() * 3;
      
      asteroid.style.left = `${x - 20}px`;
      asteroid.style.top = `${y - 20}px`;
      asteroid.dataset.vx = vx;
      asteroid.dataset.vy = vy;
      
      gameContainer.appendChild(asteroid);
      asteroids.push(asteroid);
    }

    function updateShooterGame() {
      if (!gameActive || currentGame !== 'shooter') return;
      
      // Update shoot cooldown
      if (shootCooldown > 0) {
        shootCooldown--;
        if (shootCooldown === 0) {
          canShoot = true;
        }
      }
      
      // Update bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        const bullet = bullets[i];
        const y = parseFloat(bullet.style.top);
        const vy = parseFloat(bullet.dataset.vy);
        
        bullet.style.top = `${y + vy}px`;
        
        if (y < -20) {
          if (bullet.parentNode) bullet.parentNode.removeChild(bullet);
          bullets.splice(i, 1);
          continue;
        }
        
        // Check collision with asteroids
        for (let j = asteroids.length - 1; j >= 0; j--) {
          const asteroid = asteroids[j];
          if (checkCollision(bullet, asteroid, 3, 20)) {
            createExplosion(parseFloat(asteroid.style.left) + 20, parseFloat(asteroid.style.top) + 20);
            createScorePopup(parseFloat(asteroid.style.left) + 20, parseFloat(asteroid.style.top) + 20, 10);
            
            if (bullet.parentNode) bullet.parentNode.removeChild(bullet);
            if (asteroid.parentNode) asteroid.parentNode.removeChild(asteroid);
            
            bullets.splice(i, 1);
            asteroids.splice(j, 1);
            
            score += 10;
            scoreElement.textContent = score;
            break;
          }
        }
      }
      
      // Update asteroids
      for (let i = asteroids.length - 1; i >= 0; i--) {
        const asteroid = asteroids[i];
        const x = parseFloat(asteroid.style.left);
        const y = parseFloat(asteroid.style.top);
        const vx = parseFloat(asteroid.dataset.vx);
        const vy = parseFloat(asteroid.dataset.vy);
        
        asteroid.style.left = `${x + vx}px`;
        asteroid.style.top = `${y + vy}px`;
        
        if (y > window.innerHeight + 50) {
          if (asteroid.parentNode) asteroid.parentNode.removeChild(asteroid);
          asteroids.splice(i, 1);
          continue;
        }
        
        // Check collision with spaceship
        if (spaceship && checkCollision(spaceship, asteroid, 30, 20)) {
          createExplosion(x + 20, y + 20);
          if (asteroid.parentNode) asteroid.parentNode.removeChild(asteroid);
          asteroids.splice(i, 1);
          
          shooterLives--;
          document.getElementById('lives').textContent = shooterLives;
          
          if (shooterLives <= 0) {
            endGame();
          }
        }
      }
      
      // Spawn new asteroids
      if (Math.random() < 0.02) createAsteroid();
      
      gameLoop = requestAnimationFrame(updateShooterGame);
    }

    // ===== ASTEROID DODGER GAME =====
    let dodgerShip = null;
    let dodgerX = window.innerWidth / 2;
    let dodgerY = window.innerHeight / 2;
    let dodgerTime = 0;

    function startDodgerGame() {
      console.log('Starting dodger game');
      gameActive = true;
      score = 0;
      dodgerTime = 0;
      scoreElement.textContent = score;
      gameStats.innerHTML = '<div>Time: <span id="time">0</span>s</div>';
      
      clearGameObjects();
      
      dodgerShip = document.createElement('div');
      dodgerShip.className = 'spaceship';
      dodgerShip.innerHTML = `
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <path d="M32 8 L40 40 L32 36 L24 40 Z" fill="#60a5fa" stroke="#a78bfa" stroke-width="2"/>
          <circle cx="32" cy="28" r="4" fill="#fff"/>
        </svg>
      `;
      dodgerShip.style.left = `${dodgerX - 30}px`;
      dodgerShip.style.top = `${dodgerY - 30}px`;
      gameContainer.appendChild(dodgerShip);
      
      updateDodgerGame();
    }

    function updateDodgerGame() {
      if (!gameActive || currentGame !== 'dodger') return;
      
      dodgerTime++;
      if (dodgerTime % 60 === 0) {
        score++;
        scoreElement.textContent = score;
        document.getElementById('time').textContent = Math.floor(dodgerTime / 60);
      }
      
      // Update asteroids
      for (let i = asteroids.length - 1; i >= 0; i--) {
        const asteroid = asteroids[i];
        const x = parseFloat(asteroid.style.left);
        const y = parseFloat(asteroid.style.top);
        const vx = parseFloat(asteroid.dataset.vx);
        const vy = parseFloat(asteroid.dataset.vy);
        
        asteroid.style.left = `${x + vx}px`;
        asteroid.style.top = `${y + vy}px`;
        
        if (x < -50 || x > window.innerWidth + 50 || 
            y < -50 || y > window.innerHeight + 50) {
          if (asteroid.parentNode) asteroid.parentNode.removeChild(asteroid);
          asteroids.splice(i, 1);
          continue;
        }
        
        // Check collision with spaceship
        if (dodgerShip && checkCollision(dodgerShip, asteroid, 30, 20)) {
          createExplosion(x + 20, y + 20);
          endGame();
        }
      }
      
      // Spawn asteroids
      const spawnRate = 0.01 + (dodgerTime / 6000);
      if (Math.random() < spawnRate) {
        const asteroid = document.createElement('div');
        asteroid.className = 'asteroid';
        
        const side = Math.floor(Math.random() * 4);
        let x, y, vx, vy;
        const speed = 2 + (dodgerTime / 3000);
        
        switch(side) {
          case 0: // Top
            x = Math.random() * window.innerWidth;
            y = -40;
            vx = (Math.random() - 0.5) * speed;
            vy = speed;
            break;
          case 1: // Right
            x = window.innerWidth + 40;
            y = Math.random() * window.innerHeight;
            vx = -speed;
            vy = (Math.random() - 0.5) * speed;
            break;
          case 2: // Bottom
            x = Math.random() * window.innerWidth;
            y = window.innerHeight + 40;
            vx = (Math.random() - 0.5) * speed;
            vy = -speed;
            break;
          case 3: // Left
            x = -40;
            y = Math.random() * window.innerHeight;
            vx = speed;
            vy = (Math.random() - 0.5) * speed;
            break;
        }
        
        asteroid.style.left = `${x - 20}px`;
        asteroid.style.top = `${y - 20}px`;
        asteroid.dataset.vx = vx;
        asteroid.dataset.vy = vy;
        
        gameContainer.appendChild(asteroid);
        asteroids.push(asteroid);
      }
      
      gameLoop = requestAnimationFrame(updateDodgerGame);
    }

    // ===== STAR COLLECTOR GAME =====
    let collectorShip = null;
    let collectorX = window.innerWidth / 2;
    let collectorY = window.innerHeight / 2;
    let collectorLives = 3;
    let gameStars = [];

    function startCollectorGame() {
      console.log('Starting collector game');
      gameActive = true;
      score = 0;
      collectorLives = 3;
      scoreElement.textContent = score;
      gameStats.innerHTML = `<div>Lives: <span id="collector-lives">${collectorLives}</span></div><div>Stars: <span id="stars-collected">0</span></div>`;
      
      clearGameObjects();
      
      collectorShip = document.createElement('div');
      collectorShip.className = 'spaceship';
      collectorShip.innerHTML = `
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <path d="M32 8 L40 40 L32 36 L24 40 Z" fill="#60a5fa" stroke="#a78bfa" stroke-width="2"/>
          <circle cx="32" cy="28" r="4" fill="#fff"/>
        </svg>
      `;
      collectorShip.style.left = `${collectorX - 30}px`;
      collectorShip.style.top = `${collectorY - 30}px`;
      gameContainer.appendChild(collectorShip);
      
      // Create initial stars
      for (let i = 0; i < 5; i++) {
        createCollectorStar();
      }
      
      updateCollectorGame();
    }

    function createCollectorStar() {
      const star = document.createElement('div');
      star.className = 'star-game';
      
      const x = Math.random() * (window.innerWidth - 60) + 30;
      const y = Math.random() * (window.innerHeight - 60) + 30;
      
      star.style.left = `${x - 15}px`;
      star.style.top = `${y - 15}px`;
      
      gameContainer.appendChild(star);
      gameStars.push(star);
    }

    function createDebris() {
      const debris = document.createElement('div');
      debris.className = 'asteroid';
      debris.style.width = '30px';
      debris.style.height = '30px';
      
      const side = Math.floor(Math.random() * 4);
      let x, y, vx, vy;
      
      switch(side) {
        case 0: // Top
          x = Math.random() * window.innerWidth;
          y = -30;
          vx = (Math.random() - 0.5) * 3;
          vy = 2 + Math.random() * 2;
          break;
        case 1: // Right
          x = window.innerWidth + 30;
          y = Math.random() * window.innerHeight;
          vx = -(2 + Math.random() * 2);
          vy = (Math.random() - 0.5) * 3;
          break;
        case 2: // Bottom
          x = Math.random() * window.innerWidth;
          y = window.innerHeight + 30;
          vx = (Math.random() - 0.5) * 3;
          vy = -(2 + Math.random() * 2);
          break;
        case 3: // Left
          x = -30;
          y = Math.random() * window.innerHeight;
          vx = 2 + Math.random() * 2;
          vy = (Math.random() - 0.5) * 3;
          break;
      }
      
      debris.style.left = `${x - 15}px`;
      debris.style.top = `${y - 15}px`;
      debris.dataset.vx = vx;
      debris.dataset.vy = vy;
      
      gameContainer.appendChild(debris);
      asteroids.push(debris);
    }

    function updateCollectorGame() {
      if (!gameActive || currentGame !== 'collector') return;
      
      // Update debris
      for (let i = asteroids.length - 1; i >= 0; i--) {
        const debris = asteroids[i];
        const x = parseFloat(debris.style.left);
        const y = parseFloat(debris.style.top);
        const vx = parseFloat(debris.dataset.vx);
        const vy = parseFloat(debris.dataset.vy);
        
        debris.style.left = `${x + vx}px`;
        debris.style.top = `${y + vy}px`;
        
        if (x < -50 || x > window.innerWidth + 50 || 
            y < -50 || y > window.innerHeight + 50) {
          if (debris.parentNode) debris.parentNode.removeChild(debris);
          asteroids.splice(i, 1);
          continue;
        }
        
        // Check collision with spaceship
        if (collectorShip && checkCollision(collectorShip, debris, 30, 15)) {
          createExplosion(x + 15, y + 15);
          if (debris.parentNode) debris.parentNode.removeChild(debris);
          asteroids.splice(i, 1);
          
          collectorLives--;
          document.getElementById('collector-lives').textContent = collectorLives;
          
          if (collectorLives <= 0) {
            endGame();
          }
        }
      }
      
      // Update stars
      for (let i = gameStars.length - 1; i >= 0; i--) {
        const star = gameStars[i];
        
        // Check collision with spaceship
        if (collectorShip && checkCollision(collectorShip, star, 30, 15)) {
          if (star.parentNode) star.parentNode.removeChild(star);
          gameStars.splice(i, 1);
          
          score += 10;
          scoreElement.textContent = score;
          
          const starsCollected = document.getElementById('stars-collected');
          starsCollected.textContent = parseInt(starsCollected.textContent) + 1;
          
          createScorePopup(parseFloat(star.style.left) + 15, parseFloat(star.style.top) + 15, 10);
          
          // Create new star
          createCollectorStar();
        }
      }
      
      // Spawn debris
      if (Math.random() < 0.01) {
        createDebris();
      }
      
      gameLoop = requestAnimationFrame(updateCollectorGame);
    }

    // ===== SPACE MEMORY GAME =====
    let memoryCards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let memoryMoves = 0;
    const memorySymbols = ['üöÄ', 'üõ∏', '‚≠ê', 'üåô', 'ü™ê', '‚òÑÔ∏è', 'üåå', 'üëΩ'];

    function startMemoryGame() {
      console.log('Starting memory game');
      gameActive = true;
      score = 0;
      matchedPairs = 0;
      memoryMoves = 0;
      scoreElement.textContent = score;
      gameStats.innerHTML = `<div>Moves: <span id="moves">0</span></div><div>Pairs: <span id="pairs">0/8</span></div>`;
      
      clearGameObjects();
      
      // Create memory grid
      const grid = document.createElement('div');
      grid.className = 'memory-grid';
      
      // Create pairs of cards
      const cardSymbols = [...memorySymbols, ...memorySymbols];
      cardSymbols.sort(() => Math.random() - 0.5);
      
      cardSymbols.forEach((symbol, index) => {
        const card = document.createElement('div');
        card.className = 'memory-card';
        card.dataset.symbol = symbol;
        card.dataset.index = index;
        card.textContent = '?';
        card.onclick = () => flipCard(card);
        
        grid.appendChild(card);
        memoryCards.push(card);
      });
      
      gameContainer.appendChild(grid);
    }

    function flipCard(card) {
      if (!gameActive || currentGame !== 'memory') return;
      if (card.classList.contains('flipped') || card.classList.contains('matched')) return;
      if (flippedCards.length >= 2) return;
      
      card.classList.add('flipped');
      card.textContent = card.dataset.symbol;
      flippedCards.push(card);
      
      if (flippedCards.length === 2) {
        memoryMoves++;
        document.getElementById('moves').textContent = memoryMoves;
        
        setTimeout(() => {
          if (flippedCards[0].dataset.symbol === flippedCards[1].dataset.symbol) {
            // Match found
            flippedCards[0].classList.add('matched');
            flippedCards[1].classList.add('matched');
            matchedPairs++;
            
            score += 10;
            scoreElement.textContent = score;
            
            document.getElementById('pairs').textContent = `${matchedPairs}/8`;
            
            if (matchedPairs === 8) {
              // Game won
              score += Math.max(0, 100 - memoryMoves * 2);
              scoreElement.textContent = score;
              setTimeout(endGame, 1000);
            }
          } else {
            // No match
            flippedCards[0].classList.remove('flipped');
            flippedCards[1].classList.remove('flipped');
            flippedCards[0].textContent = '?';
            flippedCards[1].textContent = '?';
          }
          
          flippedCards = [];
        }, 1000);
      }
    }

    // ===== UTILITY FUNCTIONS =====
    function clearGameObjects() {
      const gameElements = gameContainer.querySelectorAll('.spaceship, .asteroid, .star-game, .bullet, .explosion, .score-popup, .memory-grid');
      gameElements.forEach(el => el.remove());
      
      asteroids = [];
      bullets = [];
      explosions = [];
      scorePopups = [];
      memoryCards = [];
      flippedCards = [];
      gameStars = [];
    }

    function checkCollision(elem1, elem2, radius1, radius2) {
      const x1 = parseFloat(elem1.style.left) + radius1;
      const y1 = parseFloat(elem1.style.top) + radius1;
      const x2 = parseFloat(elem2.style.left) + radius2;
      const y2 = parseFloat(elem2.style.top) + radius2;
      
      const distance = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
      return distance < radius1 + radius2;
    }

    function createExplosion(x, y) {
      const explosion = document.createElement('div');
      explosion.className = 'explosion';
      explosion.style.left = `${x - 40}px`;
      explosion.style.top = `${y - 40}px`;
      
      gameContainer.appendChild(explosion);
      explosions.push(explosion);
      
      setTimeout(() => {
        if (explosion.parentNode) explosion.parentNode.removeChild(explosion);
        const index = explosions.indexOf(explosion);
        if (index > -1) explosions.splice(index, 1);
      }, 500);
    }

    function createScorePopup(x, y, points) {
      const popup = document.createElement('div');
      popup.className = 'score-popup';
      popup.textContent = `+${points}`;
      popup.style.left = `${x}px`;
      popup.style.top = `${y}px`;
      
      gameContainer.appendChild(popup);
      scorePopups.push(popup);
      
      setTimeout(() => {
        if (popup.parentNode) popup.parentNode.removeChild(popup);
        const index = scorePopups.indexOf(popup);
        if (index > -1) scorePopups.splice(index, 1);
      }, 1000);
    }

    // ===== EVENT LISTENERS =====
    let touchStartX = 0;
    let touchStartY = 0;

    function handleStart(e) {
      if (!gameActive) return;
      
      let clientX, clientY;
      if (e.type === 'touchstart') {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }
      
      touchStartX = clientX;
      touchStartY = clientY;
      
      // Game-specific actions
      if (currentGame === 'shooter' && canShoot) {
        createBullet();
      }
    }

    function handleMove(e) {
      if (!gameActive) return;
      
      let clientX, clientY;
      if (e.type === 'touchmove') {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }
      
      const deltaX = clientX - touchStartX;
      const deltaY = clientY - touchStartY;
      
      // Update ship position for applicable games
      if (currentGame === 'shooter' && spaceship) {
        spaceshipX = Math.max(30, Math.min(window.innerWidth - 30, spaceshipX + deltaX));
        spaceshipY = Math.max(30, Math.min(window.innerHeight - 30, spaceshipY + deltaY));
        spaceship.style.left = `${spaceshipX - 30}px`;
        spaceship.style.top = `${spaceshipY - 30}px`;
      } else if (currentGame === 'dodger' && dodgerShip) {
        dodgerX = Math.max(30, Math.min(window.innerWidth - 30, dodgerX + deltaX));
        dodgerY = Math.max(30, Math.min(window.innerHeight - 30, dodgerY + deltaY));
        dodgerShip.style.left = `${dodgerX - 30}px`;
        dodgerShip.style.top = `${dodgerY - 30}px`;
      } else if (currentGame === 'collector' && collectorShip) {
        collectorX = Math.max(30, Math.min(window.innerWidth - 30, collectorX + deltaX));
        collectorY = Math.max(30, Math.min(window.innerHeight - 30, collectorY + deltaY));
        collectorShip.style.left = `${collectorX - 30}px`;
        collectorShip.style.top = `${collectorY - 30}px`;
      }
      
      touchStartX = clientX;
      touchStartY = clientY;
    }

    // Add event listeners
    document.addEventListener('touchstart', handleStart, { passive: false });
    document.addEventListener('touchmove', handleMove, { passive: false });
    document.addEventListener('mousedown', handleStart);
    document.addEventListener('mousemove', handleMove);
    
    // Keyboard controls
    document.addEventListener('keydown', (e) => {
      if (!gameActive) return;
      
      if (currentGame === 'shooter' && e.code === 'Space' && canShoot) {
        e.preventDefault();
        createBullet();
      }
    });

    // Add touch event listeners to game cards for mobile
    document.querySelectorAll('.game-card').forEach(card => {
      card.addEventListener('touchstart', function(e) {
        e.preventDefault();
        const gameType = this.id.replace('-card', '');
        selectGame(gameType, e);
      });
    });
  </script>
</body>
</html>
